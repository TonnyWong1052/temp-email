
<!DOCTYPE html>
<html lang="zh-CN" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        // Detect language from URL path before page loads
        (function() {
            const path = window.location.pathname;
            if (path.startsWith('/zh-cn')) {
                document.documentElement.lang = 'zh-CN';
            } else if (path.startsWith('/en')) {
                document.documentElement.lang = 'en-US';
            }
        })();
    </script>
    <title>Á≥ªÁªüÁÆ°ÁêÜ‰∏≠ÂøÉ</title>
    <style>
        :root {
            --primary: #4F46E5;
            --primary-dark: #4338CA;
            --primary-light: #EEF2FF;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 260px;
            background: white;
            border-right: 1px solid var(--gray-200);
            padding: 24px 0;
            overflow-y: auto;
            z-index: 100;
        }

        .logo {
            padding: 0 24px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 24px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 0 16px;
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            color: var(--gray-600);
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .nav-link.active {
            background: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            stroke-width: 2;
        }

        .main-content {
            margin-left: 260px;
            min-height: 100vh;
        }

        .topbar {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 90;
        }

        .topbar-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .topbar-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
        }

        .btn-ghost {
            background: transparent;
            color: var(--gray-600);
            border: 1px solid var(--gray-300);
        }

        .btn-ghost:hover {
            background: var(--gray-100);
        }

        .content {
            padding: 32px;
        }

        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--gray-200);
            margin-bottom: 24px;
        }

        .card-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-body {
            padding: 24px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .form-input::placeholder {
            color: var(--gray-400);
        }

        .form-input:disabled {
            background: var(--gray-100);
            cursor: not-allowed;
        }

        textarea.form-input {
            resize: vertical;
            min-height: 100px;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .form-hint {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 6px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            flex-direction: column;
        }

        .alert.show {
            display: flex !important;
            align-items: stretch;
            gap: 10px;
        }

        .alert-success {
            background: #D1FAE5;
            color: #065F46;
            border: 1px solid #10B981;
        }

        .alert-error {
            background: #FEE2E2;
            color: #991B1B;
            border: 1px solid #EF4444;
        }

        .alert-warning {
            background: #FEF3C7;
            color: #92400E;
            border: 1px solid #F59E0B;
        }

        .alert-info {
            background: var(--primary-light);
            color: var(--primary-dark);
            border: 1px solid var(--primary);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-warning {
            background: #FEF3C7;
            color: #92400E;
        }

        .badge-info {
            background: var(--primary-light);
            color: var(--primary);
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loginContainer {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #f8fafc;
            position: relative;
        }

        .login-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 48px;
            width: 100%;
            max-width: 420px;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        /* Language Switcher for Login Page */
        .language-switcher-login {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 10;
        }

        .language-switcher-login .lang-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 10px;
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            color: var(--gray-600);
            font-size: 0.8125rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .language-switcher-login .lang-btn:hover {
            background: white;
            border-color: var(--primary);
            color: var(--primary);
        }

        .language-switcher-login .lang-icon {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .language-switcher-login .lang-name {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 0.8125rem;
        }

        .language-switcher-login .lang-chevron {
            width: 12px;
            height: 12px;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }

        .language-switcher-login .lang-btn[aria-expanded="true"] .lang-chevron {
            transform: rotate(180deg);
        }

        .language-switcher-login .lang-dropdown {
            position: absolute;
            top: calc(100% + 6px);
            right: 0;
            min-width: 140px;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.2s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .language-switcher-login .lang-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .language-switcher-login .lang-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            color: var(--gray-700);
            text-decoration: none;
            font-size: 0.8125rem;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--gray-100);
        }

        .language-switcher-login .lang-option:last-child {
            border-bottom: none;
        }

        .language-switcher-login .lang-option:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .language-switcher-login .lang-flag {
            font-size: 1rem;
            line-height: 1;
        }

        .language-switcher-login .lang-text {
            flex: 1;
            font-weight: 500;
        }

        .login-logo {
            width: 56px;
            height: 56px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            margin: 0 auto 20px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 6px;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--gray-600);
        }

        #configContainer {
            display: none;
        }

        .section-content {
            display: none;
        }

        .section-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }



        /* === Mobile Menu Toggle Button === */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 101;
            width: 44px;
            height: 44px;
            border: none;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .mobile-menu-toggle:hover {
            box-shadow: var(--shadow-lg);
            transform: scale(1.05);
        }

        .mobile-menu-toggle svg {
            width: 24px;
            height: 24px;
            color: var(--gray-700);
        }

        /* Sidebar Overlay for Mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.show {
            opacity: 1;
        }

        /* === Tablet & Mobile Responsive === */
        @media (max-width: 1024px) {
            .topbar-title {
                font-size: 18px;
            }

            .topbar-actions {
                gap: 8px;
            }

            .btn {
                padding: 8px 14px;
                font-size: 13px;
            }
        }

        @media (max-width: 768px) {
            /* Show mobile menu toggle */
            .mobile-menu-toggle {
                display: flex;
            }

            /* Sidebar transformations */
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                box-shadow: var(--shadow-xl);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            /* Main content adjustments */
            .main-content {
                margin-left: 0;
                width: 100%;
            }

            /* Topbar mobile layout */
            .topbar {
                padding: 16px 20px;
                padding-left: 76px; /* Space for hamburger menu */
            }

            .topbar-title {
                font-size: 16px;
            }

            .topbar-actions {
                flex-wrap: wrap;
                gap: 6px;
            }

            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .btn svg {
                width: 14px;
                height: 14px;
            }

            /* Content padding */
            .content {
                padding: 20px 16px;
            }

            /* Card adjustments */
            .card {
                margin-bottom: 20px;
            }

            .card-header {
                padding: 16px;
            }

            .card-title {
                font-size: 16px;
            }

            .card-body {
                padding: 16px;
            }

            /* Form grid to single column */
            .form-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            /* Form elements */
            .form-label {
                font-size: 13px;
            }

            .form-input,
            .form-textarea,
            .form-select {
                font-size: 14px;
                padding: 10px 12px;
            }

            /* Badges */
            .badge {
                font-size: 10px;
                padding: 2px 6px;
            }

            /* Login page */
            .login-card {
                padding: 32px 24px;
                margin: 16px;
            }

            .login-logo {
                width: 64px;
                height: 64px;
                font-size: 32px;
            }

            .login-title {
                font-size: 24px;
            }

            /* Stats grid */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .stat-card {
                padding: 12px;
            }

            .stat-value {
                font-size: 20px;
            }

            .stat-label {
                font-size: 11px;
            }

            /* Nav menu adjustments */
            .nav-link {
                padding: 12px 16px;
                font-size: 14px;
            }

            .nav-icon {
                width: 20px;
                height: 20px;
            }
        }

        /* === Small Mobile Devices === */
        @media (max-width: 480px) {
            /* Mobile menu button */
            .mobile-menu-toggle {
                top: 16px;
                left: 16px;
                width: 40px;
                height: 40px;
            }

            .mobile-menu-toggle svg {
                width: 20px;
                height: 20px;
            }

            /* Topbar compact layout */
            .topbar {
                padding: 12px 16px;
                padding-left: 64px;
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .topbar-title {
                font-size: 14px;
                width: 100%;
            }

            .topbar-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .btn {
                padding: 8px 10px;
                font-size: 11px;
            }

            .btn span {
                display: none; /* Hide button text on very small screens */
            }

            .btn svg {
                width: 16px;
                height: 16px;
                margin: 0;
            }

            /* Content adjustments */
            .content {
                padding: 16px 12px;
            }

            /* Cards */
            .card {
                border-radius: 12px;
                margin-bottom: 16px;
            }

            .card-header {
                padding: 12px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .card-title {
                font-size: 14px;
            }

            .card-body {
                padding: 12px;
            }

            /* Form elements */
            .form-group {
                margin-bottom: 14px;
            }

            .form-label {
                font-size: 12px;
                margin-bottom: 6px;
            }

            .form-input,
            .form-textarea,
            .form-select {
                font-size: 14px;
                padding: 10px;
            }

            .form-hint {
                font-size: 11px;
            }

            /* Stats - full width on very small screens */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .stat-card {
                padding: 12px;
            }

            .stat-icon {
                width: 40px;
                height: 40px;
            }

            .stat-icon svg {
                width: 20px;
                height: 20px;
            }

            .stat-value {
                font-size: 18px;
            }

            .stat-label {
                font-size: 11px;
            }

            /* Alerts */
            .alert {
                padding: 10px 12px;
                font-size: 12px;
            }

            /* Sidebar adjustments */
            .logo {
                padding: 0 16px 16px;
            }

            .logo-icon {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }

            .logo-text {
                font-size: 16px;
            }

            .nav-link {
                padding: 10px 14px;
                font-size: 13px;
            }

            .nav-icon {
                width: 18px;
                height: 18px;
            }

            /* Login page */
            .login-card {
                padding: 24px 16px;
                margin: 12px;
            }

            .login-logo {
                width: 56px;
                height: 56px;
                font-size: 28px;
            }

            .login-title {
                font-size: 20px;
            }

            /* Modal responsive */
            .modal-content {
                width: 95%;
                max-height: 90vh;
            }

            .modal-header {
                padding: 16px;
            }

            .modal-title {
                font-size: 16px;
            }

            .modal-body {
                padding: 16px;
            }

            .wizard-step {
                padding: 14px;
                margin-bottom: 16px;
            }

            .wizard-step-icon {
                width: 32px;
                height: 32px;
                font-size: 18px;
            }

            .wizard-step-title {
                font-size: 14px;
            }

            .wizard-step-desc {
                font-size: 12px;
            }

            /* Checkbox and form controls */
            .checkbox-group {
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }

            .checkbox {
                width: 18px;
                height: 18px;
            }
        }

        /* === Landscape Orientation on Mobile === */
        @media (max-width: 768px) and (orientation: landscape) {
            .sidebar {
                width: 200px;
            }

            .topbar {
                padding: 10px 16px;
                padding-left: 56px;
            }

            .content {
                padding: 16px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ÈÖçÁΩÆÂêëÂØºÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.2s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(79, 70, 229, 0);
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--gray-200);
        }

        .modal-body {
            padding: 24px;
        }

        .wizard-step {
            margin-bottom: 24px;
            padding: 20px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            transition: all 0.2s;
        }

        .wizard-step:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .wizard-step-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .wizard-step-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-light);
            border-radius: 10px;
        }

        .wizard-step-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .wizard-step-desc {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 12px;
            line-height: 1.6;
            white-space: pre-line;
        }

        .wizard-step-hint {
            font-size: 13px;
            color: var(--primary);
            background: var(--primary-light);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .wizard-step-actions {
            display: flex;
            gap: 8px;
        }

        .check-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            background: var(--gray-50);
            margin-bottom: 8px;
        }

        .check-item.passed {
            background: #D1FAE5;
            border: 1px solid #10B981;
        }

        .check-item.failed {
            background: #FEE2E2;
            border: 1px solid #EF4444;
        }

        .check-icon {
            font-size: 20px;
        }

        .check-name {
            font-weight: 600;
            color: var(--gray-900);
        }

        .check-message {
            font-size: 13px;
            color: var(--gray-600);
            margin-top: 4px;
        }

        /* ÊµÅÁ®ãÂõæÊ†∑Âºè */
        .flow-diagram {
            display: flex;
            flex-direction: column;
            gap: 24px;
            padding: 24px;
        }

        .flow-step {
            border-radius: 12px;
            padding: 20px;
            color: white;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .flow-step:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .flow-step::after {
            content: '‚Üì';
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .flow-step:last-child::after {
            display: none;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .step-number {
            background: rgba(255,255,255,0.25);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .step-icon {
            font-size: 28px;
            flex-shrink: 0;
        }

        .step-title {
            font-size: 20px;
            font-weight: 600;
            flex: 1;
        }

        .step-description {
            font-size: 14px;
            line-height: 1.8;
            opacity: 0.95;
            margin-left: 48px;
        }

        .step-detail {
            margin-left: 48px;
            margin-top: 12px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            font-size: 13px;
            backdrop-filter: blur(10px);
        }

        .step-detail code {
            background: rgba(0,0,0,0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .step-detail strong {
            font-weight: 600;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .flow-diagram {
                padding: 16px;
                gap: 20px;
            }

            .flow-step {
                padding: 16px;
            }

            .step-title {
                font-size: 18px;
            }

            .step-description {
                font-size: 13px;
                margin-left: 44px;
            }

            .step-detail {
                margin-left: 44px;
                font-size: 12px;
            }

            .flow-step::after {
                font-size: 24px;
                bottom: -22px;
            }
        }

        /* === Language Switcher for Admin === */
        .language-switcher-admin {
            position: relative;
            display: inline-block;
            margin-right: 12px;
        }

        .language-switcher-admin .lang-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            color: var(--gray-700);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .language-switcher-admin .lang-btn:hover {
            background: var(--gray-50);
            border-color: var(--primary);
            color: var(--primary);
        }

        .language-switcher-admin .lang-btn:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .language-switcher-admin .lang-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .language-switcher-admin .lang-name {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.875rem;
        }

        .language-switcher-admin .lang-chevron {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }

        .language-switcher-admin .lang-btn[aria-expanded="true"] .lang-chevron {
            transform: rotate(180deg);
        }

        .language-switcher-admin .lang-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 160px;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.2s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .language-switcher-admin .lang-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .language-switcher-admin .lang-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            color: var(--gray-700);
            text-decoration: none;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--gray-100);
        }

        .language-switcher-admin .lang-option:last-child {
            border-bottom: none;
        }

        .language-switcher-admin .lang-option:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .language-switcher-admin .lang-flag {
            font-size: 1.125rem;
            line-height: 1;
        }

        .language-switcher-admin .lang-text {
            flex: 1;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .language-switcher-admin {
                margin-right: 8px;
            }

            .language-switcher-admin .lang-btn {
                padding: 6px 10px;
            }

            .language-switcher-admin .lang-name span:not(.lang-flag) {
                display: none;
            }
        }
    </style>
    <!-- i18n Scripts -->
    <script src="/static/js/i18n.js"></script>
    <script src="/static/js/language-switcher.js"></script>
</head>
<body>
    <div id="loginContainer">
        <div class="login-card">
            <!-- Language Switcher for Login -->
            <div class="language-switcher-login" id="loginLangSwitcher"></div>

            <div class="login-header">
                <div class="login-logo">‚öôÔ∏è</div>
                <h1 class="login-title" data-i18n="pages.admin.login.page_title">Á≥ªÁªüÁÆ°ÁêÜ‰∏≠ÂøÉ</h1>
                <p class="login-subtitle" data-i18n="pages.admin.login.page_subtitle">ËØ∑ÁôªÂΩï‰ª•ÁÆ°ÁêÜÁ≥ªÁªüÈÖçÁΩÆ</p>
            </div>

            <div id="loginMessage" class="alert"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="username" data-i18n="pages.admin.login.form.username_label">Áî®Êà∑Âêç</label>
                    <input type="text" id="username" class="form-input" data-i18n-placeholder="pages.admin.login.form.username_placeholder" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label class="form-label" for="password" data-i18n="pages.admin.login.form.password_label">ÂØÜÁ†Å</label>
                    <input type="password" id="password" class="form-input" data-i18n-placeholder="pages.admin.login.form.password_placeholder" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required autocomplete="current-password">
                </div>

                <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 10px; padding: 16px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <svg width="18" height="18" fill="none" stroke="#0284c7" viewBox="0 0 24 24" style="flex-shrink: 0;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span style="font-weight: 600; color: #0c4a6e; font-size: 14px;" data-i18n="pages.admin.login.default_account.title">ÈªòËÆ§ÁÆ°ÁêÜÂëòË¥¶Êà∑</span>
                    </div>
                    <div style="font-size: 13px; color: #0c4a6e; line-height: 1.6; margin-left: 26px;">
                        <div style="margin-bottom: 4px;">
                            <span data-i18n="pages.admin.login.default_account.username_label">Áî®Êà∑ÂêçÔºö</span><code style="background: white; padding: 2px 8px; border-radius: 4px; font-family: 'SF Mono', Monaco, monospace; color: #0284c7; font-weight: 600;">admin</code>
                        </div>
                        <div>
                            <span data-i18n="pages.admin.login.default_account.password_label">ÂØÜÁ†ÅÔºö</span><code style="background: white; padding: 2px 8px; border-radius: 4px; font-family: 'SF Mono', Monaco, monospace; color: #0284c7; font-weight: 600;">admin123</code>
                        </div>
                    </div>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #bae6fd;">
                        <div style="display: flex; align-items: start; gap: 6px; font-size: 12px; color: #f59e0b;">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0; margin-top: 1px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                            <span data-i18n="pages.admin.login.default_account.warning">Áîü‰∫ßÁéØÂ¢ÉËØ∑Âä°ÂøÖ‰øÆÊîπÈªòËÆ§ÂØÜÁ†Å</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" id="loginBtn" style="width: 100%; justify-content: center;" data-i18n="pages.admin.login.form.login_button">
                    ÁôªÂΩï
                </button>
            </form>
        </div>
    </div>

    <div id="configContainer">
        <!-- Mobile Menu Toggle Button -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle" data-i18n-title="pages.admin.dashboard.buttons.open_menu" aria-label="ÈñãÂïüÈÅ∏ÂñÆ">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
        </button>

        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">‚öôÔ∏è</div>
                <span class="logo-text" data-i18n="pages.admin.dashboard.sidebar.logo">Á≥ªÁªüÁÆ°ÁêÜ</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-section="server">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/>
                        </svg>
                        <span data-i18n="pages.admin.dashboard.sidebar.server_config">ÊúçÂä°Âô®ÈÖçÁΩÆ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="cloudflare">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                        </svg>
                        <span data-i18n="pages.admin.dashboard.sidebar.cloudflare_config">Cloudflare ÂüüÂêçÈÖçÁΩÆ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="llm">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                        </svg>
                        <span data-i18n="pages.admin.dashboard.sidebar.llm_config">È™åËØÅÁ†ÅÊô∫ËÉΩÊèêÂèñ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/logs.html" target="_blank" style="color: #6b7280;">
                        <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span data-i18n="pages.admin.dashboard.sidebar.realtime_logs">ÂÆûÊó∂Êó•Âøó üîó</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="topbar">
                <h1 class="topbar-title" data-i18n="pages.admin.dashboard.title">Á≥ªÁªüÈÖçÁΩÆÁÆ°ÁêÜ</h1>
                <div class="topbar-actions">
                    <!-- Language Switcher -->
                    <div class="language-switcher-admin" id="langSwitcherContainer"></div>

                    <button class="btn btn-primary" id="saveBtn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                        </svg>
                        <span data-i18n="pages.admin.dashboard.buttons.save_config">‰øùÂ≠òÈÖçÁΩÆ</span>
                    </button>
                    <button class="btn btn-secondary" id="reloadBtn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        <span data-i18n="pages.admin.dashboard.buttons.reload_config">ÈáçËΩΩÈÖçÁΩÆ</span>
                    </button>
                    <button class="btn btn-ghost" id="logoutBtn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        <span data-i18n="pages.admin.dashboard.buttons.logout">ÁôªÂá∫</span>
                    </button>
                </div>
            </div>

            <div class="content">
                <div id="message" class="alert"></div>

                <div class="section-content active" id="section-server">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/>
                                </svg>
                                <span data-i18n="pages.admin.dashboard.sections.server.title">ÊúçÂä°Âô®ÈÖçÁΩÆ</span>
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="port">
                                        <span data-i18n="pages.admin.dashboard.sections.server.port_label">Á´ØÂè£</span> <span class="badge badge-warning" data-i18n="pages.admin.dashboard.sections.server.restart_required">ÈúÄÈáçÂêØ</span>
                                    </label>
                                    <input type="number" id="port" class="form-input" placeholder="1234">
                                    <div class="form-hint" data-i18n="pages.admin.dashboard.sections.server.port_hint">ÊúçÂä°Âô®ÁõëÂê¨Á´ØÂè£</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="host">
                                        <span data-i18n="pages.admin.dashboard.sections.server.host_label">‰∏ªÊú∫Âú∞ÂùÄ</span> <span class="badge badge-warning" data-i18n="pages.admin.dashboard.sections.server.restart_required">ÈúÄÈáçÂêØ</span>
                                    </label>
                                    <input type="text" id="host" class="form-input" placeholder="0.0.0.0">
                                    <div class="form-hint" data-i18n="pages.admin.dashboard.sections.server.host_hint">ÊúçÂä°Âô®ÁªëÂÆöÂú∞ÂùÄ</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="reload" class="checkbox">
                                    <label class="form-label" for="reload" style="margin: 0;">
                                        <span data-i18n="pages.admin.dashboard.sections.server.reload_label">ÂºÄÂèëÊ®°ÂºèËá™Âä®ÈáçËΩΩ</span> <span class="badge badge-warning" data-i18n="pages.admin.dashboard.sections.server.restart_required">ÈúÄÈáçÂêØ</span>
                                    </label>
                                </div>
                            </div>

                            <!-- ÁÆ°ÁêÜÂëòË¥¶Êà∑ÈÖçÁΩÆ -->
                            <div style="border-top: 1px solid var(--gray-200); margin-top: 24px; padding-top: 24px;">
                                <h3 style="font-size: 14px; font-weight: 600; color: var(--gray-900); margin-bottom: 16px;">
                                    <span data-i18n="pages.admin.dashboard.sections.server.admin_account">ÁÆ°ÁêÜÂëòË¥¶Êà∑</span> <span class="badge badge-warning" data-i18n="pages.admin.dashboard.sections.server.restart_required">ÈúÄÈáçÂêØ</span>
                                </h3>
                                <div class="alert alert-warning show" data-i18n="pages.admin.dashboard.sections.server.warning_relogin">
                                    ‚ö†Ô∏è ‰øÆÊîπÁÆ°ÁêÜÂëòË¥¶Êà∑ÂêéÈúÄË¶ÅÈáçÊñ∞ÁôªÂΩï
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label" for="adminUsername" data-i18n="pages.admin.dashboard.sections.server.admin_username">ÁÆ°ÁêÜÂëòÁî®Êà∑Âêç</label>
                                        <input type="text" id="adminUsername" class="form-input" placeholder="admin">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="adminPassword" data-i18n="pages.admin.dashboard.sections.server.admin_password">ÁÆ°ÁêÜÂëòÂØÜÁ†Å</label>
                                        <input type="password" id="adminPassword" class="form-input" data-i18n-placeholder="pages.admin.dashboard.sections.server.password_placeholder" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ">
                                        <div class="form-hint" data-i18n="pages.admin.dashboard.sections.server.password_hint">ÁïôÁ©∫Ë°®Á§∫‰∏ç‰øÆÊîπÂØÜÁ†Å</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="section-content" id="section-cloudflare">
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                                </svg>
                                <span data-i18n="pages.admin.dashboard.sections.cloudflare.title">Cloudflare ÈÖçÁΩÆ</span> <span class="badge badge-info" data-i18n="pages.admin.dashboard.sections.cloudflare.instant_effect">Âç≥Êó∂ÁîüÊïà</span>
                            </h2>
                            <button class="btn btn-ghost" id="showFlowBtn"
                                    style="padding: 6px 12px; font-size: 13px; text-decoration: none;"
                                    data-i18n-title="pages.admin.dashboard.buttons.show_flow"
                                    title="Êü•ÁúãÈÇÆ‰ª∂ËΩ¨ÂèëÂ∑•‰ΩúÂéüÁêÜ">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span data-i18n="pages.admin.dashboard.buttons.working_principle">Â∑•‰ΩúÂéüÁêÜ</span>
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- ÊåâÈíÆÁªÑ -->
                            <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                                <button class="btn btn-secondary" id="wizardBtn" style="flex: 1; min-width: 150px;" data-i18n="pages.admin.dashboard.buttons.wizard">
                                    üìñ ÈÖçÁΩÆÂêëÂØº
                                </button>
                                <button class="btn btn-primary" id="testConnectionBtn" style="flex: 1; min-width: 200px;" data-i18n="pages.admin.dashboard.buttons.test_connection">
                                    üîç ÊµãËØïËøûÊé•Âπ∂Ê£ÄÊü•Áä∂ÊÄÅ
                                </button>
                            </div>

                            <!-- ÁªìÊûúÊòæÁ§∫Âå∫ -->
                            <div id="cfHelperResult" class="alert" style="display: none;"></div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="cfAccountId" data-i18n="pages.admin.dashboard.sections.cloudflare.account_id_label">Cloudflare Ë¥¶Êà∑ ID</label>
                                    <input type="text" id="cfAccountId" class="form-input" data-i18n-placeholder="pages.admin.dashboard.sections.cloudflare.account_id_placeholder" placeholder="your-account-id">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="cfKvNamespaceId" data-i18n="pages.admin.dashboard.sections.cloudflare.namespace_id_label">KV Namespace ID</label>
                                    <input type="text" id="cfKvNamespaceId" class="form-input" data-i18n-placeholder="pages.admin.dashboard.sections.cloudflare.namespace_id_placeholder" placeholder="your-namespace-id">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="cfApiToken" data-i18n="pages.admin.dashboard.sections.cloudflare.api_token_label">Cloudflare API Token</label>
                                <input type="password" id="cfApiToken" class="form-input" data-i18n-placeholder="pages.admin.dashboard.sections.cloudflare.api_token_placeholder" placeholder="your-api-token">
                                <div class="form-hint">
                                    <strong data-i18n="pages.admin.dashboard.sections.cloudflare.permissions_required">üîë ÊâÄÈúÄÊùÉÈôêÔºö</strong><br>
                                    ‚Ä¢ <strong>Account Settings: Read</strong> - <span data-i18n="pages.admin.dashboard.sections.cloudflare.permission_account_read">ËØªÂèñË¥¶Êà∑‰ø°ÊÅØ</span><br>
                                    ‚Ä¢ <strong>Workers KV Storage: Read</strong> - <span data-i18n="pages.admin.dashboard.sections.cloudflare.permission_kv_read">ËØªÂèñ KV Êï∞ÊçÆ</span><br>
                                    ‚Ä¢ <strong>Zone: Read</strong> - <span data-i18n="pages.admin.dashboard.sections.cloudflare.permission_zone_read">ËØªÂèñÂüüÂêçÂàóË°®ÔºàÂüüÂêçÊ£ÄÊü•ÂäüËÉΩÔºâ</span><br>
                                    ‚Ä¢ <strong>Email Routing Rules: Read</strong> - <span data-i18n="pages.admin.dashboard.sections.cloudflare.permission_email_read">ËØªÂèñ Email Routing ÈÖçÁΩÆÔºàÂüüÂêçÊ£ÄÊü•ÂäüËÉΩÔºâ</span><br>
                                    <a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank" style="color: #3498db; text-decoration: none;" data-i18n="pages.admin.dashboard.sections.cloudflare.create_token_link">üìñ ÂàõÂª∫ API Token ‚Üí</a>
                                </div>
                            </div>

                            <!-- ÈÖçÁΩÆÊ£ÄÊü•Âô®ÊèêÁ§∫‰ø°ÊÅØ -->
                            <div class="alert alert-info show" style="margin-top: 16px;">
                                <div style="font-weight: 600; margin-bottom: 6px;" data-i18n="pages.admin.dashboard.sections.cloudflare.checker_info_title">üí° ÂÖ≥‰∫éÈÖçÁΩÆÊ£ÄÊü•Âô®</div>
                                <div style="font-size: 13px; line-height: 1.6;" id="checker-info-content">
                                    <span data-i18n="pages.admin.dashboard.sections.cloudflare.checker_info_line1">‚Ä¢ Âç≥‰ΩøÊ£ÄÊü•Âô®ÊòæÁ§∫ÈîôËØØÔºåÂ¶ÇÊûúÊÇ®ÁöÑÈÖçÁΩÆÊ≠£Á°ÆÔºå<strong>ÂäüËÉΩÂèØËÉΩ‰ªçÁÑ∂Ê≠£Â∏∏Â∑•‰Ωú</strong></span><br>
                                    <span data-i18n="pages.admin.dashboard.sections.cloudflare.checker_info_line2">‚Ä¢ ËøôÈÄöÂ∏∏ÊòØÂõ†‰∏∫ Docker ÁéØÂ¢ÉÂèòÈáèÊú™Ê≠£Á°ÆÊåÇËΩΩÊàñÊùÉÈôêÈóÆÈ¢òÂØºËá¥Ê£ÄÊü•Âô®Êó†Ê≥ïËØªÂèñÈÖçÁΩÆ</span><br>
                                    <span data-i18n="pages.admin.dashboard.sections.cloudflare.checker_info_line3">‚Ä¢ <strong>Âª∫ËÆÆ</strong>ÔºöÂÖàÂÆûÈôÖÊµãËØïÂäüËÉΩÔºàÁîüÊàêÈÇÆÁÆ±Âπ∂Â∞ùËØïÊé•Êî∂ÈÇÆ‰ª∂ÔºâÔºåÂ¶ÇÊûúÂäüËÉΩÊ≠£Â∏∏ÔºåÂèØ‰ª•ÂøΩÁï•Ê£ÄÊü•Âô®Ë≠¶Âëä</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                                </svg>
                                <span data-i18n="pages.admin.dashboard.sections.domains.title">ÂüüÂêçÁÆ°ÁêÜ</span> <span class="badge badge-info" data-i18n="pages.admin.dashboard.sections.cloudflare.instant_effect">Âç≥Êó∂ÁîüÊïà</span>
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="form-group" style="display: none;">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableCustomDomains" class="checkbox" checked>
                                    <label class="form-label" for="enableCustomDomains" style="margin: 0;" data-i18n="pages.admin.dashboard.sections.domains.enable_custom">ÂêØÁî®Ëá™ÂÆö‰πâÂüüÂêç</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="customDomains" data-i18n="pages.admin.dashboard.sections.domains.custom_domains_label">Ëá™ÂÆö‰πâÂüüÂêçÂàóË°®</label>
                                <textarea id="customDomains" class="form-input" data-i18n-placeholder="pages.admin.dashboard.sections.domains.custom_domains_placeholder" placeholder="example.com
your-domain.com
test.com" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;"></textarea>
                                <div class="form-hint" data-i18n="pages.admin.dashboard.sections.domains.custom_domains_hint">ÊØèË°åËæìÂÖ•‰∏Ä‰∏™ÂüüÂêçÔºàËá™Âä®‰ΩøÁî® Cloudflare KVÔºâ<br>‚ö†Ô∏è Ê≥®ÊÑèÔºöÂüüÂêçÂøÖÈ°ªÂ∑≤Ê∑ªÂä†Âà∞ÊÇ®ÁöÑ Cloudflare Ë¥¶Êà∑‰∏≠Âπ∂ÂÆåÊàê Email Routing ÈÖçÁΩÆ</div>
                            </div>
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableBuiltinDomains" class="checkbox">
                                    <label class="form-label" for="enableBuiltinDomains" style="margin: 0;" data-i18n="pages.admin.dashboard.sections.domains.enable_builtin">ÂêØÁî®ÂÜÖÁΩÆÂüüÂêç</label>
                                </div>
                                <div class="form-hint" style="margin-left: 28px;" data-i18n="pages.admin.dashboard.sections.domains.builtin_domains_hint">20 ‰∏™È¢ÑËÆæÁöÑ‰∏¥Êó∂ÈÇÆÁÆ±ÂüüÂêçÔºàËá™Âä®‰ΩøÁî®Â§ñÈÉ® APIÔºâ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-content" id="section-llm">
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                </svg>
                                <span data-i18n="pages.admin.dashboard.sections.llm.title">È™åËØÅÁ†ÅÊô∫ËÉΩÊèêÂèñ</span> <span class="badge badge-info" data-i18n="pages.admin.dashboard.sections.llm.instant_effect">Âç≥Êó∂ÁîüÊïà</span>
                            </h2>
                            <a href="/docs#/email/get_codes_api_email__token__codes_get" target="_blank" class="btn btn-ghost" style="padding: 6px 12px; font-size: 13px; text-decoration: none;">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span data-i18n="pages.admin.dashboard.sections.llm.api_docs">API ÊñáÊ°£</span>
                            </a>
                        </div>
                        <div class="card-body">
                            <!-- LLM È™åËØÅÁ†ÅÊèêÂèñÈªòËÆ§Â∑≤ÂêØÁî®ÔºåÊó†ÈúÄÊòæÁ§∫ÂºÄÂÖ≥ -->
                            <div class="form-group" style="display: none;">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="useLlmExtraction" class="checkbox" checked>
                                    <label class="form-label" for="useLlmExtraction" style="margin: 0;" data-i18n="pages.admin.dashboard.sections.llm.enable_llm">ÂêØÁî® LLM È™åËØÅÁ†ÅÊèêÂèñ</label>
                                </div>
                                <div class="form-hint" style="margin-left: 28px;" data-i18n="pages.admin.dashboard.sections.llm.enable_llm_hint">‰ΩøÁî® AI Ê®°ÂûãÊô∫ËÉΩËØÜÂà´È™åËØÅÁ†Å</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="openaiApiKey" data-i18n="pages.admin.dashboard.sections.llm.api_key_label">OpenAI API Key</label>
                                <input type="password" id="openaiApiKey" class="form-input" data-i18n-placeholder="pages.admin.dashboard.sections.llm.api_key_placeholder" placeholder="sk-xxx Êàñ ak-xxx">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="openaiApiBase" data-i18n="pages.admin.dashboard.sections.llm.api_base_label">API Base URL</label>
                                <input type="text" id="openaiApiBase" class="form-input" data-i18n-placeholder="pages.admin.dashboard.sections.llm.api_base_placeholder" placeholder="https://api.openai.com/v1">
                                <div class="form-hint" data-i18n="pages.admin.dashboard.sections.llm.api_base_hint">Ëá™ÂÆö‰πâ API Á´ØÁÇπÔºàÊîØÊåÅÂÖºÂÆπÊúçÂä°Ôºâ</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="openaiModel">
                                    <span data-i18n="pages.admin.dashboard.sections.llm.model_label">Ê®°ÂûãÂêçÁß∞</span>
                                    <button type="button" class="btn btn-ghost" id="detectModelsBtn"
                                            style="margin-left: 8px; padding: 4px 10px; font-size: 12px;"
                                            data-i18n="pages.admin.dashboard.buttons.detect_models"
                                            data-i18n-title="pages.admin.dashboard.sections.llm.model_label"
                                            title="‰ªé API Á´ØÁÇπËé∑ÂèñÂèØÁî®Ê®°ÂûãÂàóË°®">
                                        üîç Ëá™Âä®Ê£ÄÊµã
                                    </button>
                                </label>
                                <div style="position: relative;">
                                    <select id="openaiModelSelect" class="form-input" style="display: none;">
                                        <option value="" data-i18n="pages.admin.dashboard.sections.llm.model_select_placeholder">-- ‰ªé‰∏ãÊãâÈÄâÊã©ÊàñÂàáÊç¢Âà∞ÊâãÂä®ËæìÂÖ• --</option>
                                    </select>
                                    <input type="text" id="openaiModel" class="form-input"
                                           data-i18n-placeholder="pages.admin.dashboard.sections.llm.model_input_placeholder"
                                           placeholder="gpt-3.5-turboÔºàÊâãÂä®ËæìÂÖ•Ôºâ">
                                    <button type="button" id="toggleModelInput" class="btn btn-ghost"
                                            style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); padding: 4px 8px; font-size: 12px;"
                                            data-i18n-title="pages.admin.dashboard.sections.llm.model_toggle_title"
                                            title="ÂàáÊç¢ËæìÂÖ•ÊñπÂºè">
                                        <span data-i18n="pages.admin.dashboard.sections.llm.model_toggle_button">üìã ÂàáÊç¢</span>
                                    </button>
                                </div>
                                <div class="form-hint" id="modelHint" data-i18n="pages.admin.dashboard.sections.llm.model_hint">
                                    ÊâãÂä®ËæìÂÖ•Ê®°ÂûãÂêçÁß∞ÔºåÊàñÁÇπÂáª„ÄåËá™Âä®Ê£ÄÊµã„ÄçÂä†ËΩΩÊ®°ÂûãÂàóË°®ÂêéÂàáÊç¢Âà∞‰∏ãÊãâÈÄâÊã©
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="defaultCodeExtractionMethod">
                                    <span data-i18n="pages.admin.dashboard.sections.llm.default_method_label">ÂâçÁ´ØÈªòËÆ§ÊèêÂèñÊñπÊ≥ï</span>
                                    <span class="badge badge-info" data-i18n="pages.admin.dashboard.sections.llm.default_method_badge">ÂâçÁ´ØÈªòËÆ§</span>
                                </label>
                                <select id="defaultCodeExtractionMethod" class="form-input" style="cursor: pointer;">
                                    <option value="llm" data-i18n="pages.admin.dashboard.sections.llm.method_llm">ü§ñ LLM Êô∫ËÉΩÊèêÂèñÔºàAI ÂàÜÊûêÔºâ</option>
                                    <option value="pattern" data-i18n="pages.admin.dashboard.sections.llm.method_pattern">üìå Ê®°ÂºèËÆ≠ÁªÉÊèêÂèñÔºàÂü∫‰∫éÂ≠¶‰π†Ôºâ</option>
                                </select>
                                <div class="form-hint" data-i18n="pages.admin.dashboard.sections.llm.default_method_hint">
                                    ËÆæÁΩÆÂâçÁ´ØË∞ÉÁî® API Êó∂ÁöÑÈªòËÆ§ÊèêÂèñÊñπÊ≥ï„ÄÇLLM Ê®°ÂºèÊõ¥Êô∫ËÉΩ‰ΩÜÈúÄË¶Å API KeyÔºåÊ®°ÂºèËÆ≠ÁªÉÂü∫‰∫éÁÆ°ÁêÜÂëòÂ≠¶‰π†ÁöÑËßÑÂàôÔºåÊàêÊú¨Êõ¥‰Ωé„ÄÇ
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span data-i18n="pages.admin.dashboard.sections.llm.pattern_training_title">Ê®°ÂºèËÆ≠ÁªÉ</span> <span class="badge badge-info" data-i18n="pages.admin.dashboard.sections.llm.instant_effect">Âç≥Êó∂ÁîüÊïà</span>
                            </h2>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info show" data-i18n="pages.admin.dashboard.sections.llm.pattern_training_info">
                                ‚ÑπÔ∏è Á≤òË¥¥ÈÇÆ‰ª∂Ê†∑Êú¨ÔºåÈÄâ‰∏≠È™åËØÅÁ†ÅÊñáÊú¨ÂêéÁÇπÂáª„ÄåÂ≠¶‰π†Ê®°Âºè„ÄçÔºåÁ≥ªÁªü‰ºöËá™Âä®ËØÜÂà´ÂÖ≥ÈîÆËØçÂπ∂‰øùÂ≠òÊèêÂèñËßÑÂàô
                            </div>
                            
                            <!-- ÈÇÆ‰ª∂Ê†∑Êú¨ËæìÂÖ• -->
                            <div class="form-group">
                                <label class="form-label" for="emailSample" data-i18n="pages.admin.dashboard.sections.llm.email_sample_label">ÈÇÆ‰ª∂Ê†∑Êú¨</label>
                                <textarea id="emailSample" class="form-input"
                                          data-i18n-placeholder="pages.admin.dashboard.sections.llm.email_sample_placeholder"
                                          placeholder="Á≤òË¥¥ÈÇÆ‰ª∂ÂÜÖÂÆπÔºåÁÑ∂ÂêéÈÄâ‰∏≠È™åËØÅÁ†ÅËøõË°åËÆ≠ÁªÉ...&#10;&#10;‰æãÂ¶ÇÔºö&#10;ÊÇ®ÁöÑÈ™åËØÅÁ†ÅÊòØÔºö123456&#10;ÊúâÊïàÊúü‰∏∫5ÂàÜÈíü"
                                          style="min-height: 200px; font-family: monospace; font-size: 13px;"></textarea>
                                <div class="form-hint">
                                    <span data-i18n="pages.admin.dashboard.sections.llm.sample_hint_title">üí° <strong>Êìç‰ΩúÊ≠•È™§Ôºö</strong></span>
                                    <span data-i18n="pages.admin.dashboard.sections.llm.sample_hint_step1">‚ë† Á≤òË¥¥ÈÇÆ‰ª∂ÂÜÖÂÆπÂà∞‰∏äÊñπÊñáÊú¨Ê°Ü ‚Üí</span>
                                    <span data-i18n="pages.admin.dashboard.sections.llm.sample_hint_step2">‚ë° ‰ΩøÁî®Èº†Ê†áÊãñÂä®ÈÄâ‰∏≠È™åËØÅÁ†ÅÊñáÊú¨Ôºà‰æãÂ¶Ç <code>123456</code>Ôºâ‚Üí</span>
                                    <span data-i18n="pages.admin.dashboard.sections.llm.sample_hint_step3">‚ë¢ „Äåüìå Â≠¶‰π†ÈÄâ‰∏≠ÁöÑÈ™åËØÅÁ†ÅÊ®°Âºè„ÄçÊåâÈíÆ‰ºöËá™Âä®ÊøÄÊ¥ª ‚Üí</span>
                                    <span data-i18n="pages.admin.dashboard.sections.llm.sample_hint_step4">‚ë£ ÁÇπÂáªÊåâÈíÆÂÆåÊàêËÆ≠ÁªÉ</span>
                                </div>
                            </div>
                            
                            <!-- Êìç‰ΩúÊåâÈíÆ -->
                            <div class="form-group" style="display: flex; gap: 12px;">
                                <button id="learnPatternBtn" class="btn btn-primary" disabled data-i18n="pages.admin.dashboard.sections.llm.learn_button">
                                    üìå Â≠¶‰π†ÈÄâ‰∏≠ÁöÑÈ™åËØÅÁ†ÅÊ®°Âºè
                                </button>
                                <button id="clearSampleBtn" class="btn btn-secondary" data-i18n="pages.admin.dashboard.sections.llm.clear_button">
                                    üóëÔ∏è Ê∏ÖÁ©∫
                                </button>
                            </div>

                            <!-- Â∑≤Â≠¶‰π†Ê®°ÂºèÂàóË°® -->
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-i18n="pages.admin.dashboard.sections.llm.learned_patterns_label">Â∑≤Â≠¶‰π†ÁöÑÊ®°Âºè</span>
                                    <button class="btn btn-ghost" style="margin-left: 12px; padding: 4px 12px; font-size: 12px;" onclick="loadPatterns()" data-i18n="pages.admin.dashboard.sections.llm.reload_button">
                                        üîÑ ÈáçÊñ∞Âä†ËΩΩ
                                    </button>
                                </label>
                                <div id="patternsList" style="margin-top: 12px;">
                                    <div style="text-align: center; padding: 20px; color: var(--gray-500);" data-i18n="pages.admin.dashboard.sections.llm.loading_patterns">
                                        Âä†ËΩΩ‰∏≠...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ÈÖçÁΩÆÂêëÂØºÊ®°ÊÄÅÊ°Ü -->
    <div id="wizardModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="wizardModalTitle">üìñ Cloudflare ÈÖçÁΩÆÂêëÂØº</h3>
                <button class="modal-close" onclick="closeWizardModal()">‚úï</button>
            </div>
            <div class="modal-body" id="wizardSteps">
                <!-- Âä®ÊÄÅÂä†ËΩΩÂêëÂØºÊ≠•È™§ -->
            </div>
        </div>
    </div>

    <!-- ÊâãÂä®ÈÖçÁΩÆËØ¥ÊòéÊ®°ÊÄÅÊ°Ü -->
    <div id="manualConfigModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title" id="manualConfigModalTitle">üìù ÊâãÂä®ÈÉ®ÁΩ≤ÈÖçÁΩÆËØ¥Êòé</h3>
                <button class="modal-close" onclick="closeManualConfigModal()">‚úï</button>
            </div>
            <div class="modal-body" id="manualConfigContent">
                <!-- Âä®ÊÄÅÂä†ËΩΩÊâãÂä®ÈÖçÁΩÆÂÜÖÂÆπ -->
            </div>
        </div>
    </div>

    <!-- Â∑•‰ΩúÂéüÁêÜÊµÅÁ®ãÂõæÊ®°ÊÄÅÊ°Ü -->
    <div id="flowDiagramModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title" id="flowDiagramModalTitle">üìß ÈÇÆ‰ª∂ËΩ¨ÂèëÂ∑•‰ΩúÂéüÁêÜ</h3>
                <button class="modal-close" onclick="closeFlowDiagramModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- ÂõæÂΩ¢ÂåñÊµÅÁ®ãÂõæ -->
                <div class="flow-diagram">
                    <!-- Ê≠•È™§ 1: Áî®Êà∑ÂèëÈÄÅÈÇÆ‰ª∂ -->
                    <div class="flow-step" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="step-header">
                            <div class="step-number">‚ë†</div>
                            <div class="step-icon">üìß</div>
                            <div class="step-title">Áî®Êà∑ÂèëÈÄÅÈÇÆ‰ª∂</div>
                        </div>
                        <div class="step-description">
                            Áî®Êà∑Âêë‰∏¥Êó∂ÈÇÆÁÆ±Âú∞ÂùÄÂèëÈÄÅÈÇÆ‰ª∂Ôºà‰æãÂ¶ÇÔºötest@yourdomain.comÔºâ<br>
                            ÈÇÆ‰ª∂ÊúçÂä°Âô®Êü•ËØ¢ DNS MX ËÆ∞ÂΩïÔºåÁ°ÆÂÆöÈÇÆ‰ª∂Êé•Êî∂ÊúçÂä°Âô®
                        </div>
                        <div class="step-detail">
                            <strong>Á§∫‰æãÔºö</strong> gmail.com ‚Üí DNS Êü•ËØ¢ ‚Üí yourdomain.com MX ËÆ∞ÂΩï
                        </div>
                    </div>

                    <!-- Ê≠•È™§ 2: Cloudflare DNS -->
                    <div class="flow-step" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="step-header">
                            <div class="step-number">‚ë°</div>
                            <div class="step-icon">‚òÅÔ∏è</div>
                            <div class="step-title">Cloudflare DNS Ëß£Êûê</div>
                        </div>
                        <div class="step-description">
                            DNS MX ËÆ∞ÂΩïÊåáÂêë Cloudflare Email Routing<br>
                            ÈÇÆ‰ª∂Ë¢´Ë∑ØÁî±Âà∞ Cloudflare Âü∫Á°ÄËÆæÊñΩËøõË°åÂ§ÑÁêÜ
                        </div>
                        <div class="step-detail">
                            <strong>MX ËÆ∞ÂΩïÔºö</strong> yourdomain.com ‚Üí isaac.mx.cloudflare.net (‰ºòÂÖàÁ∫ß 10)
                        </div>
                    </div>

                    <!-- Ê≠•È™§ 3: Email Routing -->
                    <div class="flow-step" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="step-header">
                            <div class="step-number">‚ë¢</div>
                            <div class="step-icon">üì®</div>
                            <div class="step-title">Cloudflare Email Routing</div>
                        </div>
                        <div class="step-description">
                            Cloudflare Êé•Êî∂ÈÇÆ‰ª∂Âπ∂È™åËØÅÂèë‰ª∂‰∫∫<br>
                            Ëß¶ÂèëÈÖçÁΩÆÁöÑ Email Worker ËøõË°åËá™ÂÆö‰πâÂ§ÑÁêÜ
                        </div>
                        <div class="step-detail">
                            <strong>ÈÖçÁΩÆ‰ΩçÁΩÆÔºö</strong> Cloudflare Dashboard ‚Üí Email ‚Üí Email Routing ‚Üí Routes
                        </div>
                    </div>

                    <!-- Ê≠•È™§ 4: Email Worker -->
                    <div class="flow-step" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <div class="step-header">
                            <div class="step-number">‚ë£</div>
                            <div class="step-icon">‚öôÔ∏è</div>
                            <div class="step-title">Email Worker Â§ÑÁêÜ</div>
                        </div>
                        <div class="step-description">
                            JavaScript Worker Êã¶Êà™ÈÇÆ‰ª∂Âπ∂ÊâßË°å‰ª•‰∏ãÊìç‰ΩúÔºö<br>
                            ‚Ä¢ Ëß£ÊûêÈÇÆ‰ª∂ÂÜÖÂÆπÔºàÁ∫ØÊñáÊú¨ + HTMLÔºâ<br>
                            ‚Ä¢ ÊèêÂèñÂèë‰ª∂‰∫∫„ÄÅÊî∂‰ª∂‰∫∫„ÄÅ‰∏ªÈ¢ò„ÄÅÊó∂Èó¥Êà≥<br>
                            ‚Ä¢ ÁîüÊàêÂîØ‰∏ÄÁöÑÈÇÆ‰ª∂ IDÔºàÂü∫‰∫éÂÜÖÂÆπÂìàÂ∏åÔºâ
                        </div>
                        <div class="step-detail">
                            <strong>Worker Êñá‰ª∂Ôºö</strong> workers/email-handler.js
                        </div>
                    </div>

                    <!-- Ê≠•È™§ 5: Workers KV Storage -->
                    <div class="flow-step" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <div class="step-header">
                            <div class="step-number">‚ë§</div>
                            <div class="step-icon">üíæ</div>
                            <div class="step-title">Â≠òÂÇ®Âà∞ Workers KV</div>
                        </div>
                        <div class="step-description">
                            Â∞ÜÈÇÆ‰ª∂Êï∞ÊçÆÂ≠òÂÇ®Âà∞ Cloudflare Workers KVÔºàÈîÆÂÄºÊï∞ÊçÆÂ∫ìÔºâ<br>
                            ‚Ä¢ Key Ê†ºÂºèÔºö<code>mail:{ÈÇÆÁÆ±Âú∞ÂùÄ}:{Êó∂Èó¥Êà≥}</code><br>
                            ‚Ä¢ Ëá™Âä®ËÆæÁΩÆ 1 Â∞èÊó∂ËøáÊúüÊó∂Èó¥ÔºàTTL=3600 ÁßíÔºâ<br>
                            ‚Ä¢ Áª¥Êä§ÊØè‰∏™ÈÇÆÁÆ±ÁöÑÈÇÆ‰ª∂Á¥¢ÂºïÂàóË°®ÔºàÊúÄÂ§ö 50 Â∞ÅÔºâ
                        </div>
                        <div class="step-detail">
                            <strong>Á§∫‰æã KeyÔºö</strong> mail:test@example.com:1704096000000
                        </div>
                    </div>

                    <!-- Ê≠•È™§ 6: FastAPI ÂêéÁ´Ø -->
                    <div class="flow-step" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                        <div class="step-header">
                            <div class="step-number">‚ë•</div>
                            <div class="step-icon">üêç</div>
                            <div class="step-title">FastAPI ÂêéÁ´ØËØªÂèñ</div>
                        </div>
                        <div class="step-description">
                            Python ÂêéÁ´ØÈÄöËøá Cloudflare KV API ËØªÂèñÊï∞ÊçÆÔºö<br>
                            ‚Ä¢ ‰ΩøÁî® Account ID + Namespace ID + API Token ËÆ§ËØÅ<br>
                            ‚Ä¢ Ë∞ÉÁî® Cloudflare REST API Ëé∑ÂèñÈÇÆ‰ª∂<br>
                            ‚Ä¢ ËøîÂõû JSON Ê†ºÂºèÁöÑÈÇÆ‰ª∂Êï∞ÊçÆÁªôÂâçÁ´Ø
                        </div>
                        <div class="step-detail">
                            <strong>API Á´ØÁÇπÔºö</strong> GET /api/email/{token}/mails
                        </div>
                    </div>

                    <!-- Ê≠•È™§ 7: Áî®Êà∑Êü•Áúã -->
                    <div class="flow-step" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                        <div class="step-header">
                            <div class="step-number">‚ë¶</div>
                            <div class="step-icon">üåê</div>
                            <div class="step-title">Áî®Êà∑Êü•ÁúãÈÇÆ‰ª∂</div>
                        </div>
                        <div class="step-description">
                            Web ÂâçÁ´ØÊòæÁ§∫ÈÇÆ‰ª∂ÂÜÖÂÆπÔºö<br>
                            ‚Ä¢ ÊòæÁ§∫ÈÇÆ‰ª∂ÂàóË°®ÔºàÂèë‰ª∂‰∫∫„ÄÅ‰∏ªÈ¢ò„ÄÅÊó∂Èó¥Ôºâ<br>
                            ‚Ä¢ ÊòæÁ§∫ÈÇÆ‰ª∂ËØ¶ÁªÜÂÜÖÂÆπÔºàÁ∫ØÊñáÊú¨ + HTMLÔºâ<br>
                            ‚Ä¢ Ëá™Âä®ÊèêÂèñÈ™åËØÅÁ†ÅÔºà‰ΩøÁî® LLM ÊàñÊ≠£ÂàôË°®ËææÂºèÔºâ
                        </div>
                        <div class="step-detail">
                            <strong>ÂâçÁ´ØÈ°µÈù¢Ôºö</strong> http://localhost:1234/
                        </div>
                    </div>
                </div>

                <!-- Â∫ïÈÉ®ËØ¥Êòé -->
                <div style="margin-top: 24px; padding: 16px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    <div style="font-weight: 600; color: #1e40af; margin-bottom: 8px;">üí° ÊäÄÊúØ‰ºòÂäø</div>
                    <ul style="margin: 0; padding-left: 20px; color: #1e3a8a; font-size: 14px; line-height: 1.8;">
                        <li><strong>Èõ∂ÊàêÊú¨</strong>ÔºöCloudflare Workers KV ÂÖçË¥πÈ¢ùÂ∫¶ÂÖÖË∂≥ÔºàÊØèÂ§© 10 ‰∏áÊ¨°ËØªÂèñÔºâ</li>
                        <li><strong>È´òÊÄßËÉΩ</strong>ÔºöÂÖ®ÁêÉ CDN ËäÇÁÇπÔºåÊØ´ÁßíÁ∫ßÂìçÂ∫îÈÄüÂ∫¶</li>
                        <li><strong>ÂÆâÂÖ®ÂèØÈù†</strong>ÔºöÈÇÆ‰ª∂Ëá™Âä®ËøáÊúüÔºåÊó†ÈúÄÊãÖÂøÉÊï∞ÊçÆÊ≥ÑÈú≤</li>
                        <li><strong>Êòì‰∫éÊâ©Â±ï</strong>ÔºöÊîØÊåÅÂ§ö‰∏™Ëá™ÂÆö‰πâÂüüÂêçÔºåËΩªÊùæÊâ©Â±ï‰∏¥Êó∂ÈÇÆÁÆ±ÊúçÂä°</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const loginForm = document.getElementById('loginForm');
        const loginContainer = document.getElementById('loginContainer');
        const configContainer = document.getElementById('configContainer');
        const loginMessage = document.getElementById('loginMessage');
        const message = document.getElementById('message');

        // ÂØºËà™ÂàáÊç¢
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                const section = link.dataset.section;

                // Ë∑≥ËøáÂ§ñÈÉ®ÈìæÊé•ÔºàÂ¶ÇÂÆûÊó∂Êó•ÂøóÔºâ
                if (!section) {
                    return; // ÂÖÅËÆ∏ÈªòËÆ§Ë°å‰∏∫ÔºàÊâìÂºÄÈìæÊé•Ôºâ
                }

                e.preventDefault();

                // Êõ¥Êñ∞ÂØºËà™Áä∂ÊÄÅ
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                // ÊòæÁ§∫ÂØπÂ∫îÂå∫Âùó
                document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
                document.getElementById('section-' + section).classList.add('active');

                // Âú®ÁßªÂãïÁ´ØÈªûÊìäÂ∞éËà™ÂæåËá™ÂãïÈóúÈñâÂÅ¥ÈÇäÊ¨Ñ
                if (window.innerWidth <= 768) {
                    closeSidebar();
                }
            });
        });

        // ÁßªÂãïÁ´ØÈÅ∏ÂñÆÊéßÂà∂
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        function openSidebar() {
            sidebar.classList.add('show');
            sidebarOverlay.style.display = 'block';
            setTimeout(() => {
                sidebarOverlay.classList.add('show');
            }, 10);
            document.body.style.overflow = 'hidden'; // Èò≤Ê≠¢ËÉåÊôØÊªæÂãï
        }

        function closeSidebar() {
            sidebar.classList.remove('show');
            sidebarOverlay.classList.remove('show');
            setTimeout(() => {
                sidebarOverlay.style.display = 'none';
            }, 300);
            document.body.style.overflow = ''; // ÊÅ¢Âæ©ÊªæÂãï
        }

        // Êº¢Â†°ÈÅ∏ÂñÆÊåâÈàïÈªûÊìä
        if (mobileMenuToggle) {
            mobileMenuToggle.addEventListener('click', () => {
                if (sidebar.classList.contains('show')) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            });
        }

        // ÈªûÊìäÈÅÆÁΩ©Â±§ÈóúÈñâÂÅ¥ÈÇäÊ¨Ñ
        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', closeSidebar);
        }

        // Áõ£ËÅΩË¶ñÁ™óÂ§ßÂ∞èËÆäÂåñ,Âú®Ê°åÈù¢Ê®°Âºè‰∏ãÁßªÈô§ÁßªÂãïÁ´ØÈ°ûÂà•
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                sidebar.classList.remove('show');
                sidebarOverlay.style.display = 'none';
                sidebarOverlay.classList.remove('show');
                document.body.style.overflow = '';
            }
        });

        function showMessage(element, text, type) {
            // ÊîØÊåÅÁî® | ÂàÜÈöîÂ§öË°åÊ∂àÊÅØÔºàÁî®‰∫éÂêéÁ´ØËøîÂõûÁöÑËØ¶ÁªÜÈÖçÁΩÆ‰ø°ÊÅØÔºâ
            if (text.includes('|')) {
                element.innerHTML = text.split('|').map(line => line.trim()).join('<br>');
            } else {
                element.textContent = text;
            }
            element.className = `alert alert-${type} show`;
            // Ê†πÊçÆÊ∂àÊÅØÈïøÂ∫¶Âä®ÊÄÅË∞ÉÊï¥ÊòæÁ§∫Êó∂Èó¥ÔºàÊúÄÂ∞ë 5 ÁßíÔºåÊúÄÂ§ö 30 ÁßíÔºâ
            const messageLength = text.length;
            const displayTime = Math.min(30000, Math.max(5000, messageLength * 5));
            setTimeout(() => {
                element.className = 'alert';
            }, displayTime);
        }

        // Ê£ÄÊü• JWT
        async function checkSession() {
            const token = localStorage.getItem('admin_token');
            if (!token) {
                return false;
            }

            try {
                const response = await fetch('/admin/verify', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (data.authenticated) {
                    await loadConfig();
                    loginContainer.style.display = 'none';
                    configContainer.style.display = 'block';
                    return true;
                } else {
                    // Token Êó†ÊïàÔºåÊ∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
                    localStorage.removeItem('admin_token');
                    return false;
                }
            } catch (error) {
                // ËØ∑Ê±ÇÂ§±Ë¥•ÔºåÊ∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
                localStorage.removeItem('admin_token');
                return false;
            }
        }

        // ÁôªÂÖ•
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const btn = document.getElementById('loginBtn');
            const originalText = btn.innerHTML;
            const loggingInText = window.t ? window.t('pages.admin.login.form.logging_in') : 'ÁôªÂΩï‰∏≠...';
            btn.innerHTML = '<span class="loading"></span> ' + loggingInText;
            btn.disabled = true;

            try {
                const response = await fetch('/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: document.getElementById('username').value,
                        password: document.getElementById('password').value
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // ‰øùÂ≠ò JWT Âà∞ localStorage
                    localStorage.setItem('admin_token', data.token);
                    const successMsg = window.t ? window.t('pages.admin.login.messages.success') : 'ÁôªÂΩïÊàêÂäüÔºÅ';
                    showMessage(loginMessage, successMsg, 'success');
                    await loadConfig();
                    loginContainer.style.display = 'none';
                    configContainer.style.display = 'block';
                } else {
                    const failedMsg = window.t ? window.t('pages.admin.login.messages.failed') : 'ÁôªÂΩïÂ§±Ë¥•';
                    showMessage(loginMessage, data.detail || failedMsg, 'error');
                }
            } catch (error) {
                showMessage(loginMessage, 'ÁΩëÁªúÈîôËØØ: ' + error.message, 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // ËΩΩÂÖ•ÈÖçÁΩÆ
        async function loadConfig() {
            try {
                const token = localStorage.getItem('admin_token');
                if (!token) {
                    throw new Error('Êú™ÁôªÂΩï');
                }

                const response = await fetch('/admin/config/env', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Êú™ÊéàÊùÉ');
                }

                const data = await response.json();
                const config = data.config;

                // Server
                document.getElementById('port').value = config.server?.port || '';
                document.getElementById('host').value = config.server?.host || '';
                document.getElementById('reload').checked = (config.server?.reload === 'true');

                // Domains - Â§ÑÁêÜËá™ÂÆö‰πâÂüüÂêçÂàóË°®
                const customDomains = config.domains?.custom_domains || '';

                // Ë∞ÉËØïËæìÂá∫ÔºöÊòæÁ§∫ÂéüÂßãÊï∞ÊçÆ
                console.log('ÂéüÂßãËá™ÂÆö‰πâÂüüÂêçÊï∞ÊçÆ:', customDomains, 'Á±ªÂûã:', typeof customDomains);

                // Êô∫ËÉΩÂ§ÑÁêÜÂêÑÁßçÂèØËÉΩÁöÑÂüüÂêçÊ†ºÂºèÂπ∂ËΩ¨Êç¢‰∏∫ÊØèË°å‰∏Ä‰∏™ÂüüÂêçÁöÑÊ†ºÂºè
                let displayValue = '';
                if (customDomains && customDomains.trim() !== '') {
                    try {
                        // È¶ñÂÖàÂ∞ùËØï‰Ωú‰∏∫ JSON Ëß£Êûê
                        let parsed;

                        // Â§ÑÁêÜÂèØËÉΩÁöÑËΩ¨‰πâÂ≠óÁ¨¶
                        let cleanInput = customDomains;
                        if (customDomains.includes('\\"')) {
                            cleanInput = customDomains.replace(/\\"/g, '"');
                        }

                        // Â∞ùËØïËß£Êûê‰∏∫ JSON
                        parsed = JSON.parse(cleanInput);

                        if (Array.isArray(parsed)) {
                            // ÊòØÊï∞ÁªÑÔºåËΩ¨Êç¢‰∏∫Â§öË°åÊ†ºÂºè
                            displayValue = parsed.filter(domain => domain && domain.trim()).join('\n');
                        } else if (typeof parsed === 'string') {
                            // ÊòØÂ≠óÁ¨¶‰∏≤ÔºåÁõ¥Êé•‰ΩøÁî®
                            displayValue = parsed.trim();
                        } else {
                            throw new Error('ÈùûÈ¢ÑÊúüÁöÑÊï∞ÊçÆÁ±ªÂûã');
                        }
                    } catch (jsonError) {
                        // JSON Ëß£ÊûêÂ§±Ë¥•ÔºåÂ∞ùËØïÂÖ∂‰ªñÊ†ºÂºè
                        console.log('JSON Ëß£ÊûêÂ§±Ë¥•ÔºåÂ∞ùËØïÂÖ∂‰ªñÊ†ºÂºè:', jsonError);

                        // ÁßªÈô§ÂèØËÉΩÁöÑÂºïÂè∑
                        let cleanValue = customDomains.replace(/^["']|["']$/g, '');

                        // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´ÈÄóÂè∑ÔºàÂèØËÉΩÊòØÈÄóÂè∑ÂàÜÈöîÔºâ
                        if (cleanValue.includes(',')) {
                            displayValue = cleanValue
                                .split(',')
                                .map(domain => domain.trim())
                                .filter(domain => domain.length > 0)
                                .join('\n');
                        } else if (cleanValue.includes('\n')) {
                            // Â∑≤ÁªèÊòØÂ§öË°åÊ†ºÂºè
                            displayValue = cleanValue;
                        } else if (cleanValue.trim().length > 0) {
                            // Âçï‰∏ÄÂüüÂêç
                            displayValue = cleanValue.trim();
                        }
                        // Â¶ÇÊûúÂÖ®ÈÉ®ÈÉΩÂ§±Ë¥•ÔºådisplayValue ‰øùÊåÅ‰∏∫Á©∫Â≠óÁ¨¶‰∏≤
                    }
                }

                // Ë∞ÉËØïËæìÂá∫ÔºöÊòæÁ§∫Â§ÑÁêÜÂêéÁöÑÁªìÊûú
                console.log('Â§ÑÁêÜÂêéÁöÑÂüüÂêçÊòæÁ§∫ÂÄº:', displayValue);

                document.getElementById('customDomains').value = displayValue;

                document.getElementById('enableCustomDomains').checked = true; // ÂßãÁªà‰∏∫ trueÔºàÂ∑≤ÈöêËóè UIÔºâ
                document.getElementById('enableBuiltinDomains').checked = (config.domains?.enable_builtin_domains === 'true');

                // Cloudflare (KV checkbox removed - always enabled)
                document.getElementById('cfAccountId').value = config.cloudflare?.cf_account_id || '';
                document.getElementById('cfKvNamespaceId').value = config.cloudflare?.cf_kv_namespace_id || '';
                document.getElementById('cfApiToken').value = config.cloudflare?.cf_api_token || '';

                // LLM
                document.getElementById('useLlmExtraction').checked = (config.llm?.use_llm_extraction === 'true');
                document.getElementById('openaiApiKey').value = config.llm?.openai_api_key || '';
                document.getElementById('openaiApiBase').value = config.llm?.openai_api_base || '';
                document.getElementById('openaiModel').value = config.llm?.openai_model || '';
                document.getElementById('defaultCodeExtractionMethod').value = config.llm?.default_code_extraction_method || 'llm';

                // Admin
                document.getElementById('adminUsername').value = config.admin?.admin_username || '';

            } catch (error) {
                console.error('Âä†ËΩΩÈÖçÁΩÆÊó∂ÂèëÁîüÈîôËØØ:', error);
                showMessage(message, 'Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•: ' + error.message, 'error');

                // Â¶ÇÊûúÊòØÂüüÂêçÈÖçÁΩÆÈóÆÈ¢òÔºåËÆæÁΩÆ‰∏∫Á©∫ÂÄº‰ª•ÈÅøÂÖçÊòæÁ§∫ÈîôËØØÊï∞ÊçÆ
                if (error.message.includes('domain') || error.message.includes('JSON')) {
                    document.getElementById('customDomains').value = '';
                }
            }
        }

        // Ê®°ÂûãËæìÂÖ•Ê®°ÂºèÂàáÊç¢
        let isSelectMode = false;  // ÂΩìÂâçÊòØÂê¶‰∏∫‰∏ãÊãâÈÄâÊã©Ê®°Âºè
        let availableModels = [];  // Â≠òÂÇ®ÂèØÁî®ÁöÑÊ®°ÂûãÂàóË°®

        // ÂàáÊç¢ËæìÂÖ•ÊñπÂºèÊåâÈíÆ
        document.getElementById('toggleModelInput')?.addEventListener('click', function() {
            const modelInput = document.getElementById('openaiModel');
            const modelSelect = document.getElementById('openaiModelSelect');
            const modelHint = document.getElementById('modelHint');

            // Â¶ÇÊûúÂΩìÂâçÊòØÊâãÂä®ËæìÂÖ•Ê®°ÂºèÔºåÊÉ≥ÂàáÊç¢Âà∞‰∏ãÊãâÊ®°ÂºèÔºåÈúÄË¶ÅÂÖàÊúâÊ®°ÂûãÂàóË°®
            if (!isSelectMode && availableModels.length === 0) {
                modelHint.style.color = '#e74c3c';
                modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_no_models');
                setTimeout(() => {
                    modelHint.style.color = '';
                    modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_default');
                }, 3000);
                return;
            }

            // ÂàáÊç¢Ê®°Âºè
            isSelectMode = !isSelectMode;

            if (isSelectMode) {
                // ÂàáÊç¢Âà∞‰∏ãÊãâÈÄâÊã©Ê®°Âºè
                modelInput.style.display = 'none';
                modelSelect.style.display = 'block';
                this.textContent = '‚å®Ô∏è ÊâãÂä®ËæìÂÖ•';
                modelHint.textContent = `‰ªé‰∏ãÊãâÈÄâÊã©Ê®°ÂûãÔºàÂÖ± ${availableModels.length} ‰∏™Ôºâ`;

                // ÂêåÊ≠•ÂΩìÂâçÂÄº
                if (modelInput.value.trim()) {
                    modelSelect.value = modelInput.value.trim();
                }
            } else {
                // ÂàáÊç¢Âà∞ÊâãÂä®ËæìÂÖ•Ê®°ÂºèÔºàÊÄªÊòØÂÖÅËÆ∏ÂàáÊç¢ÂõûÊù•Ôºâ
                modelInput.style.display = 'block';
                modelSelect.style.display = 'none';
                this.textContent = 'üìã ‰∏ãÊãâÈÄâÊã©';
                modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_manual_mode');

                // ÂêåÊ≠•ÂΩìÂâçÂÄº
                if (modelSelect.value) {
                    modelInput.value = modelSelect.value;
                }
            }
        });

        // ‰∏ãÊãâÈÄâÊã©ÊîπÂèòÊó∂ÂêåÊ≠•Âà∞ËæìÂÖ•Ê°Ü
        document.getElementById('openaiModelSelect')?.addEventListener('change', function() {
            document.getElementById('openaiModel').value = this.value;
        });

        // Ëá™ÂãïÊ™¢Ê∏¨ÂèØÁî®ÁöÑ AI Ê®°Âûã
        document.getElementById('detectModelsBtn')?.addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.innerHTML;
            const modelInput = document.getElementById('openaiModel');
            const modelSelect = document.getElementById('openaiModelSelect');
            const modelHint = document.getElementById('modelHint');
            const toggleBtn = document.getElementById('toggleModelInput');

            // Ëé∑ÂèñÂΩìÂâçÈÖçÁΩÆ
            const apiBase = document.getElementById('openaiApiBase').value.trim();
            const apiKey = document.getElementById('openaiApiKey').value.trim();

            // È™åËØÅÂøÖÈúÄÂèÇÊï∞
            if (!apiBase) {
                modelHint.style.color = '#e74c3c';
                modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_no_api_base');
                setTimeout(() => {
                    modelHint.style.color = '';
                    modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_default');
                }, 3000);
                return;
            }

            if (!apiKey) {
                modelHint.style.color = '#e74c3c';
                modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_no_api_key');
                setTimeout(() => {
                    modelHint.style.color = '';
                    modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_default');
                }, 3000);
                return;
            }

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            btn.disabled = true;
            btn.innerHTML = '‚è≥ ' + window.t('pages.admin.dashboard.loading.detecting');
            modelHint.style.color = '#3498db';
            modelHint.textContent = window.t('pages.admin.dashboard.loading.fetching_models');

            try {
                const token = localStorage.getItem('admin_token');
                const response = await fetch('/admin/llm/models', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        openai_api_base: apiBase,
                        openai_api_key: apiKey
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();

                if (result.success && result.models && result.models.length > 0) {
                    // Â≠òÂÇ®Ê®°ÂûãÂàóË°®
                    availableModels = result.models;

                    // Êõ¥Êñ∞‰∏ãÊãâÈÄâÊã©Ê°Ü
                    modelSelect.innerHTML = '<option value="">-- ÈÄâÊã©‰∏Ä‰∏™Ê®°Âûã --</option>';
                    result.models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model;
                        option.textContent = model;
                        modelSelect.appendChild(option);
                    });

                    // Â¶ÇÊûúÂΩìÂâçËæìÂÖ•Ê°Ü‰∏∫Á©∫ÔºåËá™Âä®Â°´ÂÖ•Á¨¨‰∏Ä‰∏™Ê®°Âûã
                    if (!modelInput.value.trim() && result.models.length > 0) {
                        modelInput.value = result.models[0];
                        modelSelect.value = result.models[0];
                    } else if (modelInput.value.trim()) {
                        // ÂêåÊ≠•Áé∞ÊúâÂÄºÂà∞‰∏ãÊãâÊ°Ü
                        modelSelect.value = modelInput.value.trim();
                    }

                    // Ëá™Âä®ÂàáÊç¢Âà∞‰∏ãÊãâÈÄâÊã©Ê®°Âºè
                    isSelectMode = true;
                    modelInput.style.display = 'none';
                    modelSelect.style.display = 'block';
                    toggleBtn.textContent = '‚å®Ô∏è ÊâãÂä®ËæìÂÖ•';

                    // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                    modelHint.style.color = '#27ae60';
                    modelHint.textContent = `‚úÖ ÊàêÂäüÊ£ÄÊµãÂà∞ ${result.models.length} ‰∏™ÂèØÁî®Ê®°ÂûãÔºÅÂ∑≤Ëá™Âä®ÂàáÊç¢Âà∞‰∏ãÊãâÈÄâÊã©`;

                    // 3ÁßíÂêéÊÅ¢Â§çÊèêÁ§∫
                    setTimeout(() => {
                        modelHint.style.color = '';
                        modelHint.textContent = `‰ªé‰∏ãÊãâÈÄâÊã©Ê®°ÂûãÔºàÂÖ± ${result.models.length} ‰∏™ÔºâÔºåÊàñÁÇπÂáª„Äå‚å®Ô∏è ÊâãÂä®ËæìÂÖ•„ÄçÂàáÊç¢`;
                    }, 3000);
                } else {
                    // API ËøîÂõûÂ§±Ë¥•
                    availableModels = [];
                    modelHint.style.color = '#e74c3c';
                    modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_detect_failed', {
                        message: result.message || 'Êó†Ê≥ïËé∑ÂèñÊ®°ÂûãÂàóË°®'
                    });

                    setTimeout(() => {
                        modelHint.style.color = '';
                        modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_default');
                    }, 5000);
                }
            } catch (error) {
                console.error('Ê£ÄÊµãÊ®°ÂûãÂ§±Ë¥•:', error);
                availableModels = [];
                modelHint.style.color = '#e74c3c';
                modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_detect_failed', {
                    message: `Ê£ÄÊµãÂ§±Ë¥•: ${error.message}`
                });

                setTimeout(() => {
                    modelHint.style.color = '';
                    modelHint.textContent = window.t('pages.admin.dashboard.sections.llm.model_hint_default');
                }, 5000);
            } finally {
                // ÊÅ¢Âæ©ÊåâÈàïÁãÄÊÖã
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });

        // ‰øùÂ≠òÈÖçÁΩÆ
        document.getElementById('saveBtn').addEventListener('click', async () => {
            const btn = document.getElementById('saveBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> ' + window.t('pages.admin.dashboard.loading.saving');
            btn.disabled = true;

            try {
                const configData = {};

                // Server
                if (document.getElementById('port').value) {
                    configData.port = parseInt(document.getElementById('port').value);
                }
                if (document.getElementById('host').value) {
                    configData.host = document.getElementById('host').value;
                }
                configData.reload = document.getElementById('reload').checked;

                // Domains - Â∞ÜÂ§öË°åÂüüÂêçËΩ¨Êç¢‰∏∫ JSON Êï∞ÁªÑÊ†ºÂºè
                const domainsInput = document.getElementById('customDomains').value.trim();
                if (domainsInput) {
                    // ÊåâË°åÂàÜÂâ≤Âπ∂ËøáÊª§Á©∫Ë°å
                    const domainsArray = domainsInput
                        .split('\n')
                        .map(domain => domain.trim())
                        .filter(domain => domain.length > 0);

                    // ËΩ¨Êç¢‰∏∫ JSON Â≠óÁ¨¶‰∏≤
                    configData.custom_domains = JSON.stringify(domainsArray);
                }
                configData.enable_custom_domains = true; // ÂßãÁªàÂêØÁî®Ëá™ÂÆö‰πâÂüüÂêçÔºàÂ∑≤ÈöêËóè UI Âπ∂ÈªòËÆ§ÈÄâ‰∏≠Ôºâ
                configData.enable_builtin_domains = document.getElementById('enableBuiltinDomains').checked;

                // Cloudflare (KV always enabled)
                configData.use_cloudflare_kv = true;
                if (document.getElementById('cfAccountId').value) {
                    configData.cf_account_id = document.getElementById('cfAccountId').value;
                }
                if (document.getElementById('cfKvNamespaceId').value) {
                    configData.cf_kv_namespace_id = document.getElementById('cfKvNamespaceId').value;
                }
                if (document.getElementById('cfApiToken').value) {
                    configData.cf_api_token = document.getElementById('cfApiToken').value;
                }

                // LLM
                configData.use_llm_extraction = document.getElementById('useLlmExtraction').checked;
                if (document.getElementById('openaiApiKey').value) {
                    configData.openai_api_key = document.getElementById('openaiApiKey').value;
                }
                if (document.getElementById('openaiApiBase').value) {
                    configData.openai_api_base = document.getElementById('openaiApiBase').value;
                }
                if (document.getElementById('openaiModel').value) {
                    configData.openai_model = document.getElementById('openaiModel').value;
                }
                if (document.getElementById('defaultCodeExtractionMethod').value) {
                    configData.default_code_extraction_method = document.getElementById('defaultCodeExtractionMethod').value;
                }

                // Admin
                if (document.getElementById('adminUsername').value) {
                    configData.admin_username = document.getElementById('adminUsername').value;
                }
                if (document.getElementById('adminPassword').value) {
                    configData.admin_password = document.getElementById('adminPassword').value;
                }
                // JWT ÂØÜÈí•‰∏çÂÖÅËÆ∏‰ªéÁÆ°ÁêÜÁïåÈù¢‰øÆÊîπÔºåÂè™ËÉΩÈÄöËøáÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ
                // if (document.getElementById('adminSecretKey').value) {
                //     configData.admin_secret_key = document.getElementById('adminSecretKey').value;
                // }

                const token = localStorage.getItem('admin_token');
                if (!token) {
                    const pleaseLoginMsg = window.t ? window.t('pages.admin.login.messages.please_login') : '‚ùå ËØ∑ÂÖàÁôªÂΩï';
                    showMessage(message, pleaseLoginMsg, 'error');
                    return;
                }

                const response = await fetch('/admin/config/env', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(configData)
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showMessage(message, data.message || '‚úÖ ÈÖçÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ', 'success');
                } else {
                    showMessage(message, '‚ùå ' + (data.detail || '‰øùÂ≠òÂ§±Ë¥•'), 'error');
                }
            } catch (error) {
                showMessage(message, '‚ùå ÁΩëÁªúÈîôËØØ: ' + error.message, 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // ÈáçËΩΩÈÖçÁΩÆ
        document.getElementById('reloadBtn').addEventListener('click', async () => {
            const btn = document.getElementById('reloadBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> ' + window.t('pages.admin.dashboard.loading.reloading');
            btn.disabled = true;

            try {
                await loadConfig();
                showMessage(message, '‚úÖ ÈÖçÁΩÆÈáçËΩΩÊàêÂäüÔºÅ', 'success');
            } catch (error) {
                showMessage(message, '‚ùå ÈáçËΩΩÂ§±Ë¥•: ' + error.message, 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // ÁôªÂá∫
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                const token = localStorage.getItem('admin_token');
                if (token) {
                    await fetch('/admin/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                }

                // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®ÁöÑ JWT
                localStorage.removeItem('admin_token');
                loginContainer.style.display = 'flex';
                configContainer.style.display = 'none';
                loginForm.reset();
                showMessage(loginMessage, '‚úÖ Â∑≤ÁôªÂá∫', 'success');
            } catch (error) {
                // Âç≥‰ΩøËØ∑Ê±ÇÂ§±Ë¥•Ôºå‰πüÊ∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
                localStorage.removeItem('admin_token');
                loginContainer.style.display = 'flex';
                configContainer.style.display = 'none';
                loginForm.reset();
                showMessage(loginMessage, '‚úÖ Â∑≤ÁôªÂá∫', 'success');
            }
        });

        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü• session
        checkSession();

        // ==================== Cloudflare ËæÖÂä©ÂäüËÉΩ ====================

        // ÈÖçÁΩÆÂêëÂØº
        document.getElementById('wizardBtn').addEventListener('click', async () => {
            const btn = document.getElementById('wizardBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> ' + window.t('pages.admin.dashboard.loading.loading');
            btn.disabled = true;

            try {
                const token = localStorage.getItem('admin_token');
                const response = await fetch('/admin/cloudflare/wizard', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showWizardModal(data.steps);
                } else {
                    showCfHelperResult('Âä†ËΩΩÂêëÂØºÂ§±Ë¥•: ' + (data.detail || 'Êú™Áü•ÈîôËØØ'), 'error');
                }
            } catch (error) {
                showCfHelperResult('ÁΩëÁªúÈîôËØØ: ' + error.message, 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // ÊµãËØïËøûÊé•Âπ∂Ê£ÄÊü•Áä∂ÊÄÅÔºàÊµÅÂºèÊ£ÄÊü• - SSEÔºâ
        document.getElementById('testConnectionBtn').addEventListener('click', async () => {
            const btn = document.getElementById('testConnectionBtn');
            const resultDiv = document.getElementById('cfHelperResult');
            const originalText = btn.innerHTML;

            btn.innerHTML = '<span class="loading"></span> ' + window.t('pages.admin.dashboard.loading.checking');
            btn.disabled = true;
            resultDiv.style.display = 'block';
            resultDiv.className = 'alert alert-info show';
            resultDiv.innerHTML = '<div id="streamProgress"></div>';

            try {
                const token = localStorage.getItem('admin_token');

                // Êî∂ÈõÜÂâçÁ´ØËæìÂÖ•Ê°ÜÁöÑÂΩìÂâçÂÄº
                const formData = {
                    cf_account_id: document.getElementById('cfAccountId').value.trim() || null,
                    cf_kv_namespace_id: document.getElementById('cfKvNamespaceId').value.trim() || null,
                    cf_api_token: document.getElementById('cfApiToken').value.trim() || null
                };

                // ÂàõÂª∫ËøõÂ∫¶Êù°
                let progressBar = document.createElement('div');
                progressBar.style.cssText = 'background: #e0e0e0; height: 24px; border-radius: 12px; margin-bottom: 16px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);';
                progressBar.innerHTML = '<div id="progressFill" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600;"></div>';
                document.getElementById('streamProgress').appendChild(progressBar);

                // ÂàõÂª∫Ê∂àÊÅØÂÆπÂô®
                let messageContainer = document.createElement('pre');
                messageContainer.style.cssText = 'max-height: 400px; overflow-y: auto; background: #f5f5f5; padding: 16px; border-radius: 8px; font-size: 13px; line-height: 1.6; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; border: 1px solid #e0e0e0;';
                document.getElementById('streamProgress').appendChild(messageContainer);

                let messages = [];

                // ‰ΩøÁî® POST ËØ∑Ê±Ç‰º†ÈÄíÂèÇÊï∞ (SSE ‰∏çÊîØÊåÅ request bodyÔºåÊâÄ‰ª•Áî® URL params)
                const params = new URLSearchParams({
                    ...formData,
                    token: token
                });

                // ÂàõÂª∫ EventSource ËøõË°åÊµÅÂºèÈÄö‰ø°
                const url = `/admin/cloudflare/test-and-check-stream?${params}`;

                // Ëé∑ÂèñÂΩìÂâçËØ≠Ë®Ä
                const currentLang = window.getCurrentLanguage ? window.getCurrentLanguage() : 'en-US';

                // ‰ΩøÁî® fetch + ReadableStream Êõø‰ª£ EventSource (Âõ†‰∏∫ÈúÄË¶Å POST Âíå Auth header)
                const response = await fetch(`/admin/cloudflare/test-and-check-stream?lang=${encodeURIComponent(currentLang)}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                // Ê∑ªÂä†ÂèñÊ∂àÊåâÈíÆ
                let cancelBtn = document.createElement('button');
                cancelBtn.textContent = '‚úï ÂèñÊ∂à';
                cancelBtn.className = 'btn btn-ghost';
                cancelBtn.style.cssText = 'margin-top: 12px;';
                let cancelled = false;
                cancelBtn.onclick = () => {
                    cancelled = true;
                    reader.cancel();
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    messages.push('\n‚ö†Ô∏è Ê£ÄÊü•Â∑≤ÂèñÊ∂à');
                    messageContainer.textContent = messages.join('\n');
                };
                document.getElementById('streamProgress').appendChild(cancelBtn);

                // ËØªÂèñÊµÅÂºèÊï∞ÊçÆ
                while (true) {
                    const { done, value } = await reader.read();
                    if (done || cancelled) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const jsonStr = line.substring(6);
                            try {
                                const data = JSON.parse(jsonStr);

                                // Êõ¥Êñ∞ËøõÂ∫¶Êù°
                                if (data.progress !== undefined) {
                                    const progressFill = document.getElementById('progressFill');
                                    progressFill.style.width = data.progress + '%';
                                    progressFill.textContent = data.progress + '%';
                                }

                                // Ê∑ªÂä†Ê∂àÊÅØ
                                if (data.message) {
                                    messages.push(`[${data.stage || 'info'}] ${data.message}`);
                                    messageContainer.textContent = messages.join('\n');
                                    messageContainer.scrollTop = messageContainer.scrollHeight;
                                }

                                // Ê£ÄÊü•ÊòØÂê¶ÂÆåÊàêÊàñÈîôËØØ
                                if (data.stage === 'done') {
                                    btn.innerHTML = originalText;
                                    btn.disabled = false;
                                    resultDiv.className = 'alert alert-success show';
                                    cancelBtn.remove();

                                    // ÊòæÁ§∫ÊúÄÁªàÊëòË¶Å
                                    setTimeout(() => {
                                        const finalMsg = window.t('pages.admin.dashboard.check_messages.check_complete_success');
                                        messages.push('\n' + finalMsg);
                                        messageContainer.textContent = messages.join('\n');
                                    }, 300);
                                    break;
                                } else if (data.stage === 'error') {
                                    btn.innerHTML = originalText;
                                    btn.disabled = false;
                                    resultDiv.className = 'alert alert-warning show';  // Êîπ‰∏∫Ë≠¶ÂëäÊ†∑Âºè
                                    cancelBtn.remove();

                                    // Ê∑ªÂä†ÂèãÂ•ΩÊèêÁ§∫
                                    messages.push(`\n\n‚ö†Ô∏è ${data.message}`);
                                    if (data.can_continue) {
                                        messages.push(`\nüí° ÂèãÂ•ΩÊèêÁ§∫ÔºöËôΩÁÑ∂Ê£ÄÊµãÂà∞ÈîôËØØÔºå‰ΩÜËøô‰∏ç‰ª£Ë°®ÊúçÂä°Êó†Ê≥ï‰ΩøÁî®ÔºÅ`);
                                        messages.push(`   Âª∫ËÆÆÊÇ®ÂÖàÂ∞ùËØïÊ≠£Â∏∏‰ΩøÁî®ÊúçÂä°ÔºåÂ¶ÇÊûúÈÅáÂà∞ÂÆûÈôÖÈóÆÈ¢òÔºåÂÜçËøîÂõûÊ≠§Â§ÑË∞ÉÊï¥ÈÖçÁΩÆ„ÄÇ`);
                                    }
                                    messageContainer.textContent = messages.join('\n');
                                    break;
                                } else if (data.stage === 'warning') {
                                    // Ë≠¶ÂëäÈò∂ÊÆµ‰∏ç‰∏≠Êñ≠ÊµÅÁ®ãÔºåÁªßÁª≠ÊòæÁ§∫Ê∂àÊÅØ
                                    // ‰∏çÈúÄË¶Å breakÔºåËÆ©ÊµÅÁ®ãÁªßÁª≠
                                }
                            } catch (e) {
                                // JSON Ëß£ÊûêÂ§±Ë¥•ÔºåÂøΩÁï•
                            }
                        }
                    }
                }

                // ÊµÅÂºèËØªÂèñÂÆåÊàê
                if (!cancelled) {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    cancelBtn.remove();
                }

            } catch (error) {
                resultDiv.className = 'alert alert-error show';
                resultDiv.innerHTML = `<div style="padding: 16px;">‚ùå ÁΩëÁªúÈîôËØØ: ${error.message}</div>`;
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // ===== ÂèØÂ§çÁî®Êìç‰ΩúÂáΩÊï∞Ôºö‰æõÈÖçÁΩÆÈ°µÊåâÈíÆÂíåÈÖçÁΩÆÂêëÂØºË∞ÉÁî® =====
        // Ëá™Âä®Ê£ÄÊµãÂäüËÉΩÔºà‰ªéÈÖçÁΩÆÂêëÂØºË∞ÉÁî®Ôºâ
        async function autoDetectAction() {
            try {
                const token = localStorage.getItem('admin_token');
                const response = await fetch('/admin/cloudflare/auto-detect', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success && data.detected) {
                    // Ëá™Âä®Â°´ÂÖÖ
                    if (data.data.cf_account_id) {
                        document.getElementById('cfAccountId').value = data.data.cf_account_id;
                    }
                    if (data.data.cf_kv_namespace_id) {
                        document.getElementById('cfKvNamespaceId').value = data.data.cf_kv_namespace_id;
                    }

                    let msg = `‚úÖ ${data.message}\n`;
                    if (data.data.logged_in_as) {
                        msg += `ÁôªÂΩïË¥¶Êà∑: ${data.data.logged_in_as}\n`;
                    }
                    if (data.data.wrangler_version) {
                        msg += `Wrangler ÁâàÊú¨: ${data.data.wrangler_version}\n`;
                    }
                    if (data.data.namespace_title) {
                        msg += `Ê£ÄÊµãÂà∞ Namespace: ${data.data.namespace_title}\n`;
                    }
                    if (data.warning) {
                        msg += `‚ö†Ô∏è ${data.warning}\n`;
                    }
                    msg += '\n' + data.note;

                    showCfHelperResult(msg, 'success');
                } else {
                    // ÊûÑÂª∫ÈîôËØØÊ∂àÊÅØ
                    let errorMsg = `‚ö†Ô∏è ${data.error || 'Ëá™Âä®Ê£ÄÊµãÂ§±Ë¥•'}\n\n`;
                    errorMsg += `üí° ${data.suggestion || 'ËØ∑‰ΩøÁî®ÈÖçÁΩÆÂêëÂØºÊàñÊâãÂä®Â°´ÂÜô'}\n`;

                    // Â¶ÇÊûúÊúâÂèØÁî®ÁöÑ namespace ÂàóË°®ÔºåÊòæÁ§∫Âá∫Êù•
                    if (data.available_namespaces && data.available_namespaces.length > 0) {
                        errorMsg += `\nüì¶ ÂΩìÂâçÂèØÁî®ÁöÑ KV Namespaces:\n`;
                        data.available_namespaces.forEach(name => {
                            errorMsg += `   ‚Ä¢ ${name}\n`;
                        });
                    }

                    // Â¶ÇÊûúÊúâÈ¢ùÂ§ñËØ¥Êòé
                    if (data.note) {
                        errorMsg += `\n${data.note}\n`;
                    }

                    // ‰ºòÂÖà‰ΩøÁî®ÂêéÁ´ØËøîÂõûÁöÑ fallback_hintÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰ΩøÁî®ÈªòËÆ§ÊèêÁ§∫
                    if (data.fallback_hint) {
                        errorMsg += `\n${data.fallback_hint}`;
                    } else {
                        errorMsg += `\n‚ú® Âç≥‰ΩøËá™Âä®Ê£ÄÊµãÂ§±Ë¥•ÔºåÊÇ®‰ªçÂèØÁÇπÂáª„Äåüìñ ÈÖçÁΩÆÂêëÂØº„ÄçÊåâÈíÆÔºåËé∑ÂèñËØ¶ÁªÜÁöÑÈÖçÁΩÆÊ≠•È™§ÊåáÂºï`;
                    }

                    showCfHelperResult(errorMsg, 'warning');
                }
            } catch (error) {
                // ÊûÑÂª∫ÂèãÂ•ΩÁöÑÈîôËØØÊèêÁ§∫
                let errorMsg = `‚ùå Ëá™Âä®Ê£ÄÊµãÂ§±Ë¥•\n\n`;
                errorMsg += `ÈîôËØØÂéüÂõ†: ${error.message}\n\n`;
                errorMsg += `üí° ËØ∑ÂÖàÂÆâË£Ö Wrangler CLI: npm install -g wrangler\n\n`;
                errorMsg += `‚ú® Âç≥‰ΩøËá™Âä®Ê£ÄÊµãÂ§±Ë¥•ÔºåÊÇ®‰ªçÂèØÁÇπÂáª„Äåüìñ ÈÖçÁΩÆÂêëÂØº„ÄçÊåâÈíÆÔºåËé∑ÂèñËØ¶ÁªÜÁöÑÈÖçÁΩÆÊ≠•È™§ÊåáÂºï`;

                showCfHelperResult(errorMsg, 'error');

                // È´ò‰∫ÆÈÖçÁΩÆÂêëÂØºÊåâÈíÆ‰ª•ÂºïÂØºÁî®Êà∑Ê≥®ÊÑè
                const wizardBtn = document.getElementById('wizardBtn');
                if (wizardBtn) {
                    wizardBtn.style.animation = 'pulse 2s ease-in-out 3';
                    setTimeout(() => {
                        wizardBtn.style.animation = '';
                    }, 6000);
                }
            }
        }

        // ===== ÂÖ∂‰ªñÂèØÂ§çÁî®Êìç‰ΩúÂáΩÊï∞ =====
        async function ensureNamespaceAction() {
            const accountId = document.getElementById('cfAccountId').value;
            const apiToken = document.getElementById('cfApiToken').value;

            if (!accountId || !apiToken) {
                showCreateNamespaceModal('ËØ∑ÂÖàÂ°´ÂÜô Cloudflare Ë¥¶Êà∑ ID ‰∏é API Token', 'warning');
                return;
            }

            // ÊòæÁ§∫ËΩΩÂÖ•Áä∂ÊÄÅ
            showCreateNamespaceModal(window.t('pages.admin.dashboard.loading.creating_namespace'), 'info');

            try {
                const token = localStorage.getItem('admin_token');
                const resp = await fetch('/admin/cloudflare/kv/ensure-namespace', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title: 'EMAIL_STORAGE', cf_account_id: accountId, cf_api_token: apiToken })
                });
                const data = await resp.json();
                if (resp.ok && data.success) {
                    document.getElementById('cfKvNamespaceId').value = data.id;
                    const msg = data.created
                        ? `‚úÖ Â∑≤ÂàõÂª∫ Namespace EMAIL_STORAGE\n\nNamespace ID: ${data.id}\n\nÊ≠§ ID Â∑≤Ëá™Âä®Â°´ÂÖ•‰∏ãÊñπÂ≠óÊÆµÔºåÊÇ®ÂèØ‰ª•ÁªßÁª≠ÈÖçÁΩÆÂÖ∂‰ªñÈÄâÈ°π„ÄÇ`
                        : `‚úÖ Â∑≤ÈÄâÊã©Áé∞Êúâ Namespace EMAIL_STORAGE\n\nNamespace ID: ${data.id}\n\nÊ≠§ ID Â∑≤Ëá™Âä®Â°´ÂÖ•‰∏ãÊñπÂ≠óÊÆµÔºåÊÇ®ÂèØ‰ª•ÁªßÁª≠ÈÖçÁΩÆÂÖ∂‰ªñÈÄâÈ°π„ÄÇ`;
                    showCreateNamespaceModal(msg, 'success');
                } else {
                    showCreateNamespaceModal('‚ùå Êìç‰ΩúÂ§±Ë¥•\n\n' + (data.detail || 'Êú™Áü•ÈîôËØØ'), 'error');
                }
            } catch (e) {
                showCreateNamespaceModal('‚ùå ÁΩëÁªúÈîôËØØ\n\n' + e.message, 'error');
            }
        }

        // ÂàõÂª∫Áã¨Á´ãÁöÑ KV Namespace ÁªìÊûúÊ∂àÊÅØÊ°Ü
        function showCreateNamespaceModal(message, type) {
            // ÁßªÈô§Áé∞ÊúâÁöÑÊ∂àÊÅØÊ°ÜÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            const existingModal = document.getElementById('createNamespaceModal');
            if (existingModal) {
                existingModal.remove();
            }

            // ÂàõÂª∫Êñ∞ÁöÑÊ∂àÊÅØÊ°Ü
            const modal = document.createElement('div');
            modal.id = 'createNamespaceModal';
            modal.className = 'modal show';
            modal.style.zIndex = '1050'; // Á°Æ‰øùÂú®ÂÖ∂‰ªñÊ®°ÊÄÅÊ°Ü‰πã‰∏ä

            const typeColors = {
                success: { bg: '#D1FAE5', border: '#10B981', text: '#065F46', icon: '‚úÖ' },
                error: { bg: '#FEE2E2', border: '#EF4444', text: '#991B1B', icon: '‚ùå' },
                warning: { bg: '#FEF3C7', border: '#F59E0B', text: '#92400E', icon: '‚ö†Ô∏è' },
                info: { bg: 'var(--primary-light)', border: 'var(--primary)', text: 'var(--primary-dark)', icon: '‚ÑπÔ∏è' }
            };

            const colors = typeColors[type] || typeColors.info;

            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px; margin-top: 100px;">
                    <div class="modal-header" style="background: ${colors.bg}; border-color: ${colors.border};">
                        <h3 class="modal-title" style="color: ${colors.text}; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">${colors.icon}</span>
                            KV Namespace Êìç‰ΩúÁµêÊûú
                        </h3>
                        <button class="modal-close" onclick="closeCreateNamespaceModal()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div style="
                            background: ${colors.bg};
                            border: 2px solid ${colors.border};
                            color: ${colors.text};
                            padding: 20px;
                            border-radius: 8px;
                            font-size: 14px;
                            line-height: 1.6;
                            white-space: pre-line;
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                        ">
                            ${message}
                        </div>
                        ${type === 'success' || type === 'error' || type === 'warning' ? `
                        <div style="margin-top: 20px; text-align: center;">
                            <button class="btn btn-primary" onclick="closeCreateNamespaceModal()">Á°ÆÂÆö</button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeCreateNamespaceModal();
                }
            });

            // ESC ÈîÆÂÖ≥Èó≠
            const handleEsc = (e) => {
                if (e.key === 'Escape') {
                    closeCreateNamespaceModal();
                    document.removeEventListener('keydown', handleEsc);
                }
            };
            document.addEventListener('keydown', handleEsc);
        }

        // ÂÖ≥Èó≠ KV Namespace ÁªìÊûúÊ∂àÊÅØÊ°Ü
        function closeCreateNamespaceModal() {
            const modal = document.getElementById('createNamespaceModal');
            if (modal) {
                modal.remove();
            }
        }

        // ÂÖ®Â±ÄÂèòÈáèÂ≠òÂÇ®ÂΩìÂâçÁâáÊÆµÂÜÖÂÆπ
        let currentSnippetContent = '';

        // ÂàõÂª∫ Wrangler ÁâáÊÆµÊ∂àÊÅØÊ°Ü
        function showWranglerSnippetModal(message, type, snippet = null) {
            // ÁßªÈô§Áé∞ÊúâÁöÑÊ∂àÊÅØÊ°ÜÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            const existingModal = document.getElementById('wranglerSnippetModal');
            if (existingModal) {
                existingModal.remove();
            }

            // Â≠òÂÇ®ÁâáÊÆµÂÜÖÂÆπÂà∞ÂÖ®Â±ÄÂèòÈáè
            currentSnippetContent = snippet || '';

            // ÂàõÂª∫Êñ∞ÁöÑÊ∂àÊÅØÊ°Ü
            const modal = document.createElement('div');
            modal.id = 'wranglerSnippetModal';
            modal.className = 'modal show';
            modal.style.zIndex = '1050';

            const typeColors = {
                success: { bg: '#D1FAE5', border: '#10B981', text: '#065F46', icon: '‚úÖ' },
                error: { bg: '#FEE2E2', border: '#EF4444', text: '#991B1B', icon: '‚ùå' },
                warning: { bg: '#FEF3C7', border: '#F59E0B', text: '#92400E', icon: '‚ö†Ô∏è' },
                info: { bg: 'var(--primary-light)', border: 'var(--primary)', text: 'var(--primary-dark)', icon: '‚ÑπÔ∏è' }
            };

            const colors = typeColors[type] || typeColors.info;

            // ÁîüÊàê‰ª£Á†ÅÁâáÊÆµÊòæÁ§∫Âå∫Âüü
            const snippetHtml = snippet ? `
                <div style="margin-top: 16px;">
                    <div id="snippetCodeDisplay" style="
                        background: #1f2937;
                        color: #10b981;
                        padding: 16px;
                        border-radius: 8px;
                        font-family: 'Monaco', 'Courier New', monospace;
                        font-size: 13px;
                        white-space: pre-line;
                        border: 2px solid #374151;
                        position: relative;
                        user-select: text;
                        cursor: text;
                    ">${snippet}</div>
                    <div style="margin-top: 12px; text-align: center;">
                        <button class="btn btn-secondary" onclick="copyCurrentSnippet()">
                            üìã Â§çÂà∂ÈÖçÁΩÆÁâáÊÆµ
                        </button>
                        <button class="btn btn-secondary" onclick="selectSnippetText()" style="margin-left: 8px;">
                            üéØ ÈÄâÂèñÊñáÊú¨
                        </button>
                    </div>
                </div>
            ` : '';

            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px; margin-top: 50px;">
                    <div class="modal-header" style="background: ${colors.bg}; border-color: ${colors.border};">
                        <h3 class="modal-title" style="color: ${colors.text}; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">${colors.icon}</span>
                            Wrangler ÈÖçÁΩÆÁâáÊÆµ
                        </h3>
                        <button class="modal-close" onclick="closeWranglerSnippetModal()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div style="
                            background: ${colors.bg};
                            border: 2px solid ${colors.border};
                            color: ${colors.text};
                            padding: 20px;
                            border-radius: 8px;
                            font-size: 14px;
                            line-height: 1.6;
                            white-space: pre-line;
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                        ">
                            ${message}
                        </div>
                        ${snippetHtml}
                        ${type === 'success' || type === 'error' || type === 'warning' ? `
                        <div style="margin-top: 20px; text-align: center;">
                            <button class="btn btn-primary" onclick="closeWranglerSnippetModal()">Á°ÆÂÆö</button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeWranglerSnippetModal();
                }
            });

            // ESC ÈîÆÂÖ≥Èó≠
            const handleEsc = (e) => {
                if (e.key === 'Escape') {
                    closeWranglerSnippetModal();
                    document.removeEventListener('keydown', handleEsc);
                }
            };
            document.addEventListener('keydown', handleEsc);
        }

        // ÂÖ≥Èó≠ Wrangler ÁâáÊÆµÊ∂àÊÅØÊ°Ü
        function closeWranglerSnippetModal() {
            const modal = document.getElementById('wranglerSnippetModal');
            if (modal) {
                modal.remove();
            }
        }

        // Â§çÂà∂ÂΩìÂâçÁâáÊÆµÂà∞Ââ™Ë¥¥Êùø
        function copyCurrentSnippet() {
            if (!currentSnippetContent) {
                alert('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÈÖçÁΩÆÁâáÊÆµ');
                return;
            }

            // ‰ΩøÁî®Áé∞‰ª£ Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(currentSnippetContent).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    // Fallback to older method
                    fallbackCopySnippet();
                });
            } else {
                // Fallback for older browsers
                fallbackCopySnippet();
            }
        }

        // ÊòæÁ§∫Â§çÂà∂ÊàêÂäüÊèêÁ§∫
        function showCopySuccess() {
            const btn = event.target;
            const originalText = btn.innerHTML;
            const originalBg = btn.style.background;
            const originalColor = btn.style.color;

            btn.innerHTML = '‚úÖ Â∑≤Â§çÂà∂';
            btn.style.background = '#10B981';
            btn.style.color = 'white';

            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = originalBg;
                btn.style.color = originalColor;
            }, 2000);
        }

        // ÊóßÁâàÊµèËßàÂô®ÁöÑÂ§çÂà∂ÊñπÊ≥ï
        function fallbackCopySnippet() {
            // ÂàõÂª∫‰∏¥Êó∂ÊñáÊú¨Âå∫Âüü
            const textArea = document.createElement('textarea');
            textArea.value = currentSnippetContent;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);

            try {
                textArea.focus();
                textArea.select();
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess();
                } else {
                    throw new Error('execCommand failed');
                }
            } catch (err) {
                // ÊúÄÁªàÁöÑÈîôËØØÂ§ÑÁêÜ
                alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®ÈÄâÂèñÂπ∂Â§çÂà∂‰ª£Á†ÅÁâáÊÆµ\n\nÊÇ®ÂèØ‰ª•ÁÇπÂáª„ÄåüéØ ÈÄâÂèñÊñáÊú¨„ÄçÊåâÈíÆÊù•ÈÄâÂèñ‰ª£Á†Å');
            } finally {
                document.body.removeChild(textArea);
            }
        }

        // ÈÄâÂèñÁâáÊÆµÊñáÊú¨
        function selectSnippetText() {
            const codeDisplay = document.getElementById('snippetCodeDisplay');
            if (!codeDisplay) {
                alert('Êâæ‰∏çÂà∞‰ª£Á†ÅÁâáÊÆµ');
                return;
            }

            // ÈÄâÂèñÊñáÊú¨
            if (window.getSelection && document.createRange) {
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(codeDisplay);
                selection.removeAllRanges();
                selection.addRange(range);

                // ÊèêÁ§∫Áî®Êà∑
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚úÖ Â∑≤ÈÄâÂèñ';
                btn.style.background = '#3B82F6';
                btn.style.color = 'white';

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                    btn.style.color = '';
                }, 2000);

                // ÊèêÁ§∫Áî®Êà∑ÂèØ‰ª•Â§çÂà∂
                setTimeout(() => {
                    alert('‰ª£Á†ÅÂ∑≤ÈÄâÂèñÔºåËØ∑Êåâ Ctrl+C (Windows) Êàñ Cmd+C (Mac) Â§çÂà∂');
                }, 100);
            } else {
                alert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËá™Âä®ÈÄâÂèñÔºåËØ∑ÊâãÂä®ÈÄâÂèñ‰ª£Á†ÅÁâáÊÆµ');
            }
        }

        // ÂàõÂª∫ÂÜôÂÖ• Wrangler Êñá‰ª∂Ê∂àÊÅØÊ°Ü
        function showWriteWranglerModal(message, type) {
            // ÁßªÈô§Áé∞ÊúâÁöÑÊ∂àÊÅØÊ°ÜÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            const existingModal = document.getElementById('writeWranglerModal');
            if (existingModal) {
                existingModal.remove();
            }

            // ÂàõÂª∫Êñ∞ÁöÑÊ∂àÊÅØÊ°Ü
            const modal = document.createElement('div');
            modal.id = 'writeWranglerModal';
            modal.className = 'modal show';
            modal.style.zIndex = '1050';

            const typeColors = {
                success: { bg: '#D1FAE5', border: '#10B981', text: '#065F46', icon: '‚úÖ' },
                error: { bg: '#FEE2E2', border: '#EF4444', text: '#991B1B', icon: '‚ùå' },
                warning: { bg: '#FEF3C7', border: '#F59E0B', text: '#92400E', icon: '‚ö†Ô∏è' },
                info: { bg: 'var(--primary-light)', border: 'var(--primary)', text: 'var(--primary-dark)', icon: '‚ÑπÔ∏è' }
            };

            const colors = typeColors[type] || typeColors.info;

            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px; margin-top: 100px;">
                    <div class="modal-header" style="background: ${colors.bg}; border-color: ${colors.border};">
                        <h3 class="modal-title" style="color: ${colors.text}; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">${colors.icon}</span>
                            ÂÜôÂÖ• wrangler.toml
                        </h3>
                        <button class="modal-close" onclick="closeWriteWranglerModal()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div style="
                            background: ${colors.bg};
                            border: 2px solid ${colors.border};
                            color: ${colors.text};
                            padding: 20px;
                            border-radius: 8px;
                            font-size: 14px;
                            line-height: 1.6;
                            white-space: pre-line;
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                        ">
                            ${message}
                        </div>
                        ${type === 'success' || type === 'error' || type === 'warning' ? `
                        <div style="margin-top: 20px; text-align: center;">
                            <button class="btn btn-primary" onclick="closeWriteWranglerModal()">Á°ÆÂÆö</button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeWriteWranglerModal();
                }
            });

            // ESC ÈîÆÂÖ≥Èó≠
            const handleEsc = (e) => {
                if (e.key === 'Escape') {
                    closeWriteWranglerModal();
                    document.removeEventListener('keydown', handleEsc);
                }
            };
            document.addEventListener('keydown', handleEsc);
        }

        // ÂÖ≥Èó≠ÂÜôÂÖ• Wrangler Ê∂àÊÅØÊ°Ü
        function closeWriteWranglerModal() {
            const modal = document.getElementById('writeWranglerModal');
            if (modal) {
                modal.remove();
            }
        }

        async function wranglerSnippetAction() {
            const namespaceId = document.getElementById('cfKvNamespaceId').value;
            if (!namespaceId) {
                showWranglerSnippetModal('‚ö†Ô∏è ËØ∑ÂÖàÂ°´ÂÜôÊàñÂàõÂª∫ KV Namespace ID\n\nËØ∑Á°Æ‰øùÊÇ®Â∑≤ÂÆåÊàêÊ≠•È™§ 2 Âπ∂Â°´ÂÖ•‰∫ÜÊúâÊïàÁöÑ Namespace ID„ÄÇ', 'warning');
                return;
            }

            // È°ØÁ§∫ËºâÂÖ•ÁãÄÊÖã
            showWranglerSnippetModal(window.t('pages.admin.dashboard.loading.generating_wrangler'), 'info');

            try {
                const token = localStorage.getItem('admin_token');
                const resp = await fetch(`/admin/cloudflare/wrangler-snippet?binding=EMAIL_STORAGE&namespace_id=${encodeURIComponent(namespaceId)}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await resp.json();
                if (resp.ok && data.success) {
                    const message = `‚úÖ Wrangler ÈÖçÁΩÆÁâáÊÆµÂ∑≤ÁîüÊàê\n\nËØ∑Â∞Ü‰ª•‰∏ãÁâáÊÆµÂ§çÂà∂Âà∞ workers/wrangler.toml Êñá‰ª∂‰∏≠Ôºö\n\n${data.snippet}\n‰ΩøÁî®ÊñπÊ≥ïÔºö\n1. Â§çÂà∂‰∏äÈù¢ÁöÑÈÖçÁΩÆÁâáÊÆµ\n2. ÊâìÂºÄ workers/wrangler.toml Êñá‰ª∂\n3. Â∞ÜÁâáÊÆµÁ≤òË¥¥Âà∞Êñá‰ª∂‰∏≠\n4. ‰øùÂ≠òÊñá‰ª∂\n5. Âú® workers ÁõÆÂΩïÊâßË°å: wrangler deploy`;
                    showWranglerSnippetModal(message, 'success', data.snippet);
                } else {
                    showWranglerSnippetModal('‚ùå ÁîüÊàêÂ§±Ë¥•\n\n' + (data.detail || 'Êú™Áü•ÈîôËØØ'), 'error');
                }
            } catch (e) {
                showWranglerSnippetModal('‚ùå ÁΩëÁªúÈîôËØØ\n\n' + e.message, 'error');
            }
        }

        async function writeWranglerAction() {
            const namespaceId = document.getElementById('cfKvNamespaceId').value;
            if (!namespaceId) {
                showWriteWranglerModal('‚ö†Ô∏è ËØ∑ÂÖàÂ°´ÂÜôÊàñÂàõÂª∫ KV Namespace ID\n\nËØ∑Á°Æ‰øùÊÇ®Â∑≤ÂÆåÊàêÊ≠•È™§ 2 Âπ∂Â°´ÂÖ•‰∫ÜÊúâÊïàÁöÑ Namespace ID„ÄÇ', 'warning');
                return;
            }

            // Ëé∑ÂèñÊñá‰ª∂Ë∑ØÂæÑ
            const filePath = prompt('wrangler.toml Ë∑ØÂæÑ', 'workers/wrangler.toml');
            if (!filePath) return;

            // ÊòæÁ§∫ËΩΩÂÖ•Áä∂ÊÄÅ
            showWriteWranglerModal(window.t('pages.admin.dashboard.loading.writing_wrangler'), 'info');

            try {
                const token = localStorage.getItem('admin_token');
                const resp = await fetch('/admin/cloudflare/write-wrangler', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ file_path: filePath, binding: 'EMAIL_STORAGE', namespace_id: namespaceId, confirm: true })
                });
                const data = await resp.json();
                if (resp.ok && data.success) {
                    const message = `‚úÖ wrangler.toml Â∑≤ÊàêÂäüÊõ¥Êñ∞\n\nÊñá‰ª∂Ë∑ØÂæÑ: ${data.file}\n\nÊé•‰∏ãÊù•ÁöÑÊ≠•È™§:\n1. Á°ÆËÆ§ workers/wrangler.toml Êñá‰ª∂Â∑≤Ê≠£Á°ÆÊõ¥Êñ∞\n2. Âú® workers ÁõÆÂΩïÊâßË°å: wrangler deploy\n3. ÂÆåÊàê Worker ÈÉ®ÁΩ≤Âà∞ Cloudflare`;
                    showWriteWranglerModal(message, 'success');
                } else {
                    const message = `‚ùå ÂÜôÂÖ•Â§±Ë¥•\n\nÈîôËØØËØ¶ÊÉÖ: ${data.detail || 'Êú™Áü•ÈîôËØØ'}\n\nüí° Âª∫ËÆÆËß£ÂÜ≥ÊñπÊ°à:\n‚Ä¢ Ê£ÄÊü•Êñá‰ª∂Ë∑ØÂæÑÊòØÂê¶Ê≠£Á°Æ\n‚Ä¢ Á°Æ‰øùÊúâÂÜôÂÖ•ÊùÉÈôê\n‚Ä¢ Êàñ‰ΩøÁî®„Äåüß© Wrangler ÁâáÊÆµ„ÄçÂäüËÉΩÊâãÂä®Â§çÂà∂ÈÖçÁΩÆ`;
                    showWriteWranglerModal(message, 'error');
                }
            } catch (e) {
                showWriteWranglerModal('‚ùå ÁΩëÁªúÈîôËØØ\n\n' + e.message, 'error');
            }
        }

        // Â∑≤ÁßªÈô§ Cloudflare Èù¢ÊùøÂÜÖÁöÑ„ÄåÂàõÂª∫/ÁâáÊÆµ/ÂÜôÂÖ•„ÄçÊåâÈíÆÔºà‰øùÁïôÂú®ÈÖçÁΩÆÂêëÂØºÂÜÖÔºâ

        // ÊòæÁ§∫ÈÖçÁΩÆÂêëÂØºÊ®°ÊÄÅÊ°Ü
        function showWizardModal(steps) {
            // Update modal title with i18n
            const titleElement = document.getElementById('wizardModalTitle');
            if (titleElement && window.t) {
                titleElement.textContent = window.t('pages.admin.dashboard.modals.wizard_title');
            }

            const wizardSteps = document.getElementById('wizardSteps');
            wizardSteps.innerHTML = '';

            // ÂêëÂØºÂÜÖÊ∂àÊÅØÊ°ÜÔºàÁî®‰∫éÊòæÁ§∫ Wrangler ÁâáÊÆµÁ≠âÔºâ
            const wizardMsgBox = document.createElement('div');
            wizardMsgBox.id = 'wizardMsgBox';
            wizardMsgBox.className = 'alert';
            wizardMsgBox.style.display = 'none';
            wizardSteps.appendChild(wizardMsgBox);

            // Pre-load all translations to ensure they're available
            const t = window.t || ((key) => key);

            steps.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'wizard-step';

                // ÊûÑÂª∫ÂëΩ‰ª§Â±ïÁ§∫Âå∫ÂüüÔºàÂ¶ÇÊûúÂ≠òÂú®ÂëΩ‰ª§Ôºâ
                let commandHtml = '';
                if (step.command) {
                    const copyCommandText = t('pages.admin.dashboard.wizard.buttons.copy_command');
                    commandHtml = `
                        <div style="background: var(--gray-900); color: #00ff00; padding: 12px; border-radius: 6px; margin: 12px 0; font-family: 'Monaco', 'Courier New', monospace; font-size: 13px; position: relative;">
                            <code style="display: block; white-space: pre-wrap;">${step.command}</code>
                        </div>
                        <button class="btn btn-ghost" onclick="copyCommand('${step.command.replace(/'/g, "\\'")}'); event.stopPropagation();" style="margin-bottom: 8px;">
                            ${copyCommandText}
                        </button>
                    `;
                }
                
                // ÊûÑÂª∫ÊåâÈíÆÂå∫Âüü
                let actionsHtml = '<div class="wizard-step-actions">';

                // Ê∑ªÂä† Cloudflare ÊúçÂä°ÈìæÊé•ÊåâÈíÆÔºàÂ¶ÇÊûúÊúâ URLÔºå‰ΩÜÊéíÈô§ step 4Ôºâ
                if (step.url && String(step.id) !== '4') {
                    // Ê†πÊçÆÊ≠•È™§ ID Ëá™ÂÆö‰πâÊåâÈíÆÊñáÊú¨
                    let buttonText = t('pages.admin.dashboard.wizard.buttons.open_link');
                    if (String(step.id) === '1') {
                        buttonText = t('pages.admin.dashboard.wizard.buttons.open_dashboard');
                    } else if (String(step.id) === '2') {
                        buttonText = t('pages.admin.dashboard.wizard.buttons.open_api_token');
                    } else if (String(step.id) === '3') {
                        buttonText = t('pages.admin.dashboard.wizard.buttons.open_kv_management');
                    } else if (String(step.id) === '5') {
                        buttonText = t('pages.admin.dashboard.wizard.buttons.open_email_routing');
                    }

                    actionsHtml += `
                        <a href="${step.url}" target="_blank" class="btn btn-primary" style="text-decoration: none; display: inline-flex; align-items: center; gap: 6px;">
                            ${buttonText}
                        </a>
                    `;
                }

                if (step.field_id) {
                    const gotoFillText = t('pages.admin.dashboard.wizard.buttons.goto_fill');
                    actionsHtml += `
                        <button class="btn btn-secondary" onclick="focusField('${step.field_id}')">
                            ${gotoFillText}
                        </button>
                    `;
                }
                // Âú®Ê≠•È™§ 1 Ê∑ªÂä†Ëá™Âä®Ê£ÄÊµãÊåâÈíÆ
                if (String(step.id) === '1') {
                    const autoDetectText = t('pages.admin.dashboard.wizard.buttons.auto_detect');
                    actionsHtml += `
                        <button class="btn btn-ghost" onclick="triggerAutoDetectFromWizard(event)" style="font-size: 13px;">
                            ${autoDetectText}
                        </button>
                    `;
                }
                // Â∞Ü„ÄåÂàõÂª∫ KV Namespace„ÄçÊåâÈíÆÊ∑ªÂä†Âà∞Ê≠•È™§ 3
                if (String(step.id) === '3') {
                    const quickFillKvText = t('pages.admin.dashboard.wizard.buttons.quick_fill_kv');
                    actionsHtml += `
                        <button class="btn btn-primary" onclick="ensureNamespaceAction()">
                            ${quickFillKvText}
                        </button>
                    `;
                }
                // Â∞Ü‰∏ÄÈîÆÈÉ®ÁΩ≤ÊåâÈíÆÂíåÊâãÂä®ÈÖçÁΩÆÈÄâÈ°πÊ∑ªÂä†Âà∞Ê≠•È™§ 4
                if (String(step.id) === '4') {
                    // Ëé∑ÂèñÊâãÂä®ÈÖçÁΩÆËØ¥ÊòéÔºàÂ¶ÇÊûúÊúâÔºâ
                    const manualConfigDesc = step.manual_config_description || '';
                    const manualConfigText = t('pages.admin.dashboard.wizard.buttons.manual_config');

                    actionsHtml += `
                        <div style="margin-top: 8px; display: flex; justify-content: center;">
                            <a href="https://deploy.workers.cloudflare.com/?url=https://github.com/TonnyWong1052/temp-email/tree/main/workers" target="_blank">
                                <img src="https://deploy.workers.cloudflare.com/button" alt="Deploy to Cloudflare Workers" style="border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';" />
                            </a>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px;">
                            <button class="btn btn-ghost" onclick="showManualConfigMessage(\`${manualConfigDesc}\`)" style="flex: 1; height: 40px; display: flex; align-items: center; justify-content: center; text-align: center; line-height: 1.2; padding: 8px;">
                                <span style="font-size: 14px;">${manualConfigText}</span>
                            </button>
                        </div>
                    `;
                }
                actionsHtml += '</div>';

                const stepLabelText = t('pages.admin.dashboard.wizard.step_label');
                stepDiv.innerHTML = `
                    <div class="wizard-step-header">
                        <div class="wizard-step-icon">${step.icon}</div>
                        <div class="wizard-step-title">${stepLabelText} ${step.id}: ${step.title}</div>
                    </div>
                    <div class="wizard-step-desc">${step.description}</div>
                    <div class="wizard-step-hint">üí° ${step.hint}</div>
                    ${commandHtml}
                    ${actionsHtml}
                `;
                wizardSteps.appendChild(stepDiv);
            });


            document.getElementById('wizardModal').classList.add('show');
        }

        // Âú®ÂêëÂØºÂÜÖÊòæÁ§∫Ê∂àÊÅØ
        function showWizardMessage(message, type, autoHide = false) {
            const box = document.getElementById('wizardMsgBox');
            if (!box) {
                showCfHelperResult(message, type || 'info');
                return;
            }
            box.innerHTML = message.replace(/\n/g, '<br>');
            box.className = `alert alert-${type || 'info'} show`;
            box.style.display = 'block';
            box.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            // Â¶ÇÊûúÂêØÁî®Ëá™Âä®ÈöêËóèÔºåÊ†πÊçÆÊ∂àÊÅØÈïøÂ∫¶Âä®ÊÄÅË∞ÉÊï¥ÊòæÁ§∫Êó∂Èó¥
            if (autoHide) {
                const messageLength = message.length;
                const displayTime = Math.min(30000, Math.max(5000, messageLength * 5));
                setTimeout(() => {
                    box.style.display = 'none';
                }, displayTime);
            }
        }
        
        // Â§çÂà∂ÂëΩ‰ª§Âà∞Ââ™Ë¥¥Êùø
        function copyCommand(command) {
            navigator.clipboard.writeText(command).then(() => {
                showCfHelperResult('‚úÖ ÂëΩ‰ª§Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                setTimeout(() => {
                    document.getElementById('cfHelperResult').style.display = 'none';
                }, 2000);
            }).catch(err => {
                showCfHelperResult('‚ùå Â§çÂà∂Â§±Ë¥•: ' + err.message, 'error');
            });
        }

        // ÂÖ≥Èó≠ÈÖçÁΩÆÂêëÂØº
        function closeWizardModal() {
            document.getElementById('wizardModal').classList.remove('show');
        }

        // ‰ªéÈÖçÁΩÆÂêëÂØºËß¶ÂèëËá™Âä®Ê£ÄÊµã
        async function triggerAutoDetectFromWizard(event) {
            const btn = event.target;
            const originalText = btn.innerHTML;
            const resultDiv = document.getElementById('cfHelperResult');

            // ÊòæÁ§∫ÊåâÈíÆËΩΩÂÖ•Âä®Áîª
            btn.innerHTML = '<span class="loading"></span> ' + window.t('pages.admin.dashboard.loading.detecting');
            btn.disabled = true;

            // Âú®ÁªìÊûúÂå∫ÂüüÊòæÁ§∫ËΩΩÂÖ•Âä®ÁîªÔºà‰∏éÊµãËØïËøûÊé•Áõ∏ÂêåÁöÑ‰ΩçÁΩÆÔºâ
            resultDiv.style.display = 'block';
            resultDiv.className = 'alert alert-info show';
            resultDiv.innerHTML = '<div style="padding: 16px;"><span class="loading"></span> ' + window.t('pages.admin.dashboard.loading.auto_detecting') + '</div>';

            try {
                // ÂÖ≥Èó≠ÂêëÂØºÊ®°ÊÄÅÊ°Ü
                closeWizardModal();

                // Ë∞ÉÁî®Ëá™Âä®Ê£ÄÊµãÂäüËÉΩ
                await autoDetectAction();
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // ÊòæÁ§∫ÊâãÂä®ÈÖçÁΩÆËØ¥ÊòéÁöÑÁã¨Á´ãÊ®°ÊÄÅÊ°Ü
        function showManualConfigMessage(manualConfigDesc) {
            if (!manualConfigDesc) {
                alert('ÊöÇÊó†ÊâãÂä®ÈÖçÁΩÆËØ¥Êòé');
                return;
            }

            // ÊûÑÂª∫ÂÆåÊï¥ÁöÑÊ∂àÊÅØÂÜÖÂÆπ
            const content = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 20px; white-space: pre-line; line-height: 1.8; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                    <div style="font-weight: 600; font-size: 18px; margin-bottom: 16px; text-align: center;">üìù ÊâãÂä®ÈÉ®ÁΩ≤Ê≠•È™§ËØ¥Êòé</div>
                    <div style="font-size: 14px;">${manualConfigDesc}</div>
                </div>
                <div style="background: var(--gray-50); padding: 20px; border-radius: 12px; border: 1px solid var(--gray-200);">
                    <div style="font-size: 16px; font-weight: 600; color: var(--gray-800); margin-bottom: 16px; text-align: center;">
                        üõ†Ô∏è Wrangler ÈÖçÁΩÆÂ∑•ÂÖ∑
                    </div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; align-items: center;">
                        <button class="btn btn-secondary" onclick="wranglerSnippetAction(); closeManualConfigModal();" style="font-size: 14px; padding: 10px 20px;">
                            üß© Wrangler ÁâáÊÆµ
                        </button>
                        <span style="color: var(--gray-500); font-size: 14px;">Êàñ</span>
                        <button class="btn btn-ghost" onclick="writeWranglerAction(); closeManualConfigModal();" style="font-size: 14px; padding: 10px 20px;">
                            ‚úçÔ∏è ÂÜôÂÖ• wrangler.toml
                        </button>
                    </div>
                    <div style="font-size: 13px; color: var(--gray-600); margin-top: 16px; text-align: center; background: white; padding: 12px; border-radius: 8px;">
                        üí° ‰ºòÂÖà‰ΩøÁî®‰∏ÄÈîÆÈÉ®ÁΩ≤ÊåâÈíÆ„ÄÇÊâãÂä®ÈÖçÁΩÆ‰ªÖ‰Ωú‰∏∫Â§áÈÄâÊñπÊ°à„ÄÇ
                    </div>
                </div>
            `;

            // ËÆæÁΩÆÂÜÖÂÆπÂπ∂ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            document.getElementById('manualConfigContent').innerHTML = content;
            document.getElementById('manualConfigModal').classList.add('show');
        }

        // ÂÖ≥Èó≠ÊâãÂä®ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function closeManualConfigModal() {
            document.getElementById('manualConfigModal').classList.remove('show');
        }

        // ÊòæÁ§∫Â∑•‰ΩúÂéüÁêÜÊµÅÁ®ãÂõæ
        document.getElementById('showFlowBtn')?.addEventListener('click', function() {
            const t = window.t || ((key) => key);

            // Update modal title with i18n
            const titleElement = document.getElementById('flowDiagramModalTitle');
            if (titleElement) {
                titleElement.textContent = t('pages.admin.dashboard.modals.flow_diagram_title');
            }

            // Update all flow diagram steps
            const modal = document.getElementById('flowDiagramModal');
            if (modal) {
                const steps = modal.querySelectorAll('.flow-step');
                steps.forEach((step, index) => {
                    const stepNum = index + 1;
                    const titleEl = step.querySelector('.step-title');
                    const descEl = step.querySelector('.step-description');
                    const detailEl = step.querySelector('.step-detail');

                    if (titleEl) titleEl.innerHTML = t(`pages.admin.dashboard.flow_diagram.step${stepNum}_title`);
                    if (descEl) descEl.innerHTML = t(`pages.admin.dashboard.flow_diagram.step${stepNum}_desc`);
                    if (detailEl) detailEl.innerHTML = t(`pages.admin.dashboard.flow_diagram.step${stepNum}_detail`);
                });

                // Update advantages section
                const advantagesTitle = modal.querySelector('.modal-body > div:last-child > div:first-child');
                if (advantagesTitle) {
                    advantagesTitle.innerHTML = t('pages.admin.dashboard.flow_diagram.advantages_title');
                }

                const advantagesList = modal.querySelectorAll('.modal-body > div:last-child ul li');
                advantagesList.forEach((li, index) => {
                    li.innerHTML = t(`pages.admin.dashboard.flow_diagram.advantage${index + 1}`);
                });
            }

            document.getElementById('flowDiagramModal').classList.add('show');
        });

        // ÂÖ≥Èó≠ÊµÅÁ®ãÂõæÊ®°ÊÄÅÊ°Ü
        function closeFlowDiagramModal() {
            document.getElementById('flowDiagramModal').classList.remove('show');
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠ÊµÅÁ®ãÂõæ
        document.getElementById('flowDiagramModal')?.addEventListener('click', function(e) {
            if (e.target.id === 'flowDiagramModal') {
                closeFlowDiagramModal();
            }
        });

        // ËÅöÁÑ¶Âà∞ÊåáÂÆöÂ≠óÊÆµ
        function focusField(fieldId) {
            closeWizardModal();
            // ÂàáÊç¢Âà∞ Cloudflare ÈÖçÁΩÆÈ°µÈù¢
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelector('.nav-link[data-section="cloudflare"]').classList.add('active');
            document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
            document.getElementById('section-cloudflare').classList.add('active');

            // ËÅöÁÑ¶Âπ∂È´ò‰∫Æ
            const field = document.getElementById(fieldId);
            if (field) {
                field.focus();
                field.scrollIntoView({ behavior: 'smooth', block: 'center' });
                field.style.borderColor = 'var(--primary)';
                field.style.boxShadow = '0 0 0 3px var(--primary-light)';
                setTimeout(() => {
                    field.style.borderColor = '';
                    field.style.boxShadow = '';
                }, 2000);
            }
        }

        // ÊòæÁ§∫ÊµãËØïÁªìÊûú
        function showTestResult(data) {
            const resultDiv = document.getElementById('cfHelperResult');
            let html = '';

            if (data.checks && data.checks.length > 0) {
                data.checks.forEach(check => {
                    const isPassed = check.status === 'passed';
                    html += `
                        <div class="check-item ${isPassed ? 'passed' : 'failed'}">
                            <div class="check-icon">${check.icon}</div>
                            <div style="flex: 1;">
                                <div class="check-name">${check.name}</div>
                                <div class="check-message">${check.message}</div>
                            </div>
                        </div>
                    `;
                });
            }

            html += `<div style="margin-top: 12px; font-weight: 600;">${data.message}</div>`;

            resultDiv.innerHTML = html;
            resultDiv.style.display = 'flex';
            resultDiv.style.flexDirection = 'column';
            resultDiv.className = `alert alert-${data.overall_status === 'success' ? 'success' : 'error'} show`;

            // Ëá™Âä®ÊªöÂä®Âà∞ÁªìÊûúÂå∫Âüü
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ÊòæÁ§∫ËæÖÂä©ÂäüËÉΩÁªìÊûú
        function showCfHelperResult(message, type) {
            const resultDiv = document.getElementById('cfHelperResult');
            resultDiv.innerHTML = message.replace(/\n/g, '<br>');
            resultDiv.className = `alert alert-${type} show`;
            // Ê†πÊçÆÊ∂àÊÅØÈïøÂ∫¶Âä®ÊÄÅË∞ÉÊï¥ÊòæÁ§∫Êó∂Èó¥ÔºàÊúÄÂ∞ë 15 ÁßíÔºåÊúÄÂ§ö 60 ÁßíÔºâ
            const messageLength = message.length;
            const displayTime = Math.min(60000, Math.max(15000, messageLength * 10));
            setTimeout(() => {
                resultDiv.className = 'alert';
            }, displayTime);
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        document.getElementById('wizardModal').addEventListener('click', (e) => {
            if (e.target.id === 'wizardModal') {
                closeWizardModal();
            }
        });

        document.getElementById('manualConfigModal').addEventListener('click', (e) => {
            if (e.target.id === 'manualConfigModal') {
                closeManualConfigModal();
            }
        });

        // ÁõëÂê¨ESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' || e.keyCode === 27) {
                // ÂÖ≥Èó≠ÊâãÂä®ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
                const manualConfigModal = document.getElementById('manualConfigModal');
                if (manualConfigModal && manualConfigModal.classList.contains('show')) {
                    closeManualConfigModal();
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }

                // ÂÖ≥Èó≠ÊµÅÁ®ãÂõæÊ®°ÊÄÅÊ°Ü
                const flowDiagramModal = document.getElementById('flowDiagramModal');
                if (flowDiagramModal && flowDiagramModal.classList.contains('show')) {
                    closeFlowDiagramModal();
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }

                // ÂÖ≥Èó≠ÈÖçÁΩÆÂêëÂØºÊ®°ÊÄÅÊ°Ü
                const wizardModal = document.getElementById('wizardModal');
                if (wizardModal && wizardModal.classList.contains('show')) {
                    closeWizardModal();
                    e.preventDefault();
                    e.stopPropagation();
                }
            }
        });

        // ==================== Pattern Training Functions ====================

        // ÁõëÂê¨ÊñáÊú¨ÈÄâ‰∏≠‰∫ã‰ª∂
        document.getElementById('emailSample').addEventListener('mouseup', function() {
            const textarea = this;
            const selectedText = textarea.value.substring(
                textarea.selectionStart,
                textarea.selectionEnd
            ).trim();

            const learnBtn = document.getElementById('learnPatternBtn');

            // Âà§Êñ≠ÊòØÂê¶ÂèØËÉΩÊòØÈ™åËØÅÁ†Å (4-10‰ΩçÂ≠óÊØçÊï∞Â≠ó)
            if (selectedText.length >= 4 && selectedText.length <= 10) {
                if (/^[A-Z0-9]+$/i.test(selectedText)) {
                    learnBtn.disabled = false;
                    learnBtn.innerHTML = window.t('pages.admin.dashboard.sections.llm.learn_button_with_text', {
                        text: selectedText
                    });
                    learnBtn.dataset.selectedText = selectedText;
                    learnBtn.dataset.selectionStart = textarea.selectionStart;
                } else {
                    learnBtn.disabled = true;
                    learnBtn.innerHTML = window.t('pages.admin.dashboard.sections.llm.learn_button');
                }
            } else {
                learnBtn.disabled = true;
                learnBtn.innerHTML = window.t('pages.admin.dashboard.sections.llm.learn_button');
            }
        });

        // Â≠¶‰π†Ê®°ÂºèÊåâÈíÆ
        document.getElementById('learnPatternBtn').addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.innerHTML;
            const selectedText = btn.dataset.selectedText;
            const selectionStart = parseInt(btn.dataset.selectionStart);
            const emailContent = document.getElementById('emailSample').value;

            if (!selectedText || !emailContent) {
                showMessage(message, '‚ùå ËØ∑ÂÖàÁ≤òË¥¥ÈÇÆ‰ª∂Âπ∂ÈÄâ‰∏≠È™åËØÅÁ†Å', 'error');
                return;
            }

            btn.innerHTML = '<span class="loading"></span> ' + window.t('pages.admin.dashboard.loading.learning');
            btn.disabled = true;

            try {
                const token = localStorage.getItem('admin_token');
                const response = await fetch('/api/patterns/learn', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email_content: emailContent,
                        highlighted_code: selectedText,
                        highlight_position: selectionStart
                    })
                });

                const t = window.t || ((key) => key);

                // Check HTTP status first
                if (!response.ok) {
                    showMessage(message, t('pages.admin.dashboard.sections.llm.patterns.api_error', { message: response.status }), 'error');
                    return;
                }

                const data = await response.json();

                if (data.success) {
                    const keywords = data.preview.keywords_before.join('„ÄÅ');
                    showMessage(message, t('pages.admin.dashboard.sections.llm.patterns.learn_success', { keywords: keywords }), 'success');
                    loadPatterns(); // ÈáçÊñ∞Âä†ËΩΩÊ®°ÂºèÂàóË°®
                } else {
                    showMessage(message, t('pages.admin.dashboard.sections.llm.patterns.learn_failed', { message: data.message || 'Â≠¶‰π†Â§±Ë¥•' }), 'error');
                }
            } catch (error) {
                const t = window.t || ((key) => key);
                showMessage(message, t('pages.admin.dashboard.sections.llm.patterns.learn_network_error', { message: error.message }), 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // Ê∏ÖÁ©∫ÊåâÈíÆ
        document.getElementById('clearSampleBtn').addEventListener('click', function() {
            document.getElementById('emailSample').value = '';
            const learnBtn = document.getElementById('learnPatternBtn');
            learnBtn.disabled = true;
            learnBtn.innerHTML = window.t('pages.admin.dashboard.sections.llm.learn_button');
        });

        // Âä†ËΩΩÂ∑≤Â≠¶‰π†Ê®°ÂºèÂàóË°®
        async function loadPatterns() {
            const patternsList = document.getElementById('patternsList');
            const t = window.t || ((key) => key);

            patternsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--gray-500);">' + t('pages.admin.dashboard.sections.llm.loading_patterns') + '</div>';

            try {
                const token = localStorage.getItem('admin_token');
                const response = await fetch('/api/patterns', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    if (data.patterns.length === 0) {
                        patternsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--gray-500);">' + t('pages.admin.dashboard.sections.llm.patterns.no_patterns') + '</div>';
                        return;
                    }

                    let html = '';
                    data.patterns.forEach(pattern => {
                        const successRate = pattern.usage_count > 0 
                            ? Math.round(pattern.success_rate * 100) 
                            : 0;
                        
                        // Êà™ÂèñÈÇÆ‰ª∂ÂÜÖÂÆπÈ¢ÑËßàÔºàÊúÄÂ§ö150‰∏™Â≠óÁ¨¶Ôºâ
                        const emailPreview = pattern.email_content.length > 150 
                            ? pattern.email_content.substring(0, 150) + '...' 
                            : pattern.email_content;
                        
                        // Translate code type
                        const codeTypeText = pattern.code_type === 'numeric'
                            ? t('pages.admin.dashboard.sections.llm.patterns.numeric')
                            : t('pages.admin.dashboard.sections.llm.patterns.alphanumeric');

                        // Build translated labels
                        const keywordsLabel = t('pages.admin.dashboard.sections.llm.patterns.keywords_label');
                        const digitsText = t('pages.admin.dashboard.sections.llm.patterns.digits_suffix');
                        const emailContentLabel = t('pages.admin.dashboard.sections.llm.patterns.email_content_label');
                        const highlightedLabel = t('pages.admin.dashboard.sections.llm.patterns.highlighted_code_label');
                        const usageText = t('pages.admin.dashboard.sections.llm.patterns.usage_count', { count: pattern.usage_count });
                        const successRateText = t('pages.admin.dashboard.sections.llm.patterns.success_rate', { rate: successRate });
                        const deleteButtonText = t('pages.admin.dashboard.sections.llm.patterns.delete_button');

                        html += `
                            <div class="pattern-item" style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                    <div style="flex: 1;">
                                        <!-- ÈÇÆ‰ª∂ÂÜÖÂÆπÈ¢ÑËßà -->
                                        <div style="background: var(--gray-50); border-radius: 6px; padding: 12px; margin-bottom: 8px;">
                                            <div style="font-size: 11px; color: var(--gray-500); margin-bottom: 4px; font-weight: 600;">${emailContentLabel}</div>
                                            <div style="font-size: 12px; color: var(--gray-700); line-height: 1.5; font-family: monospace; white-space: pre-wrap;">${emailPreview}</div>
                                        </div>

                                        <!-- È´ò‰∫ÆÈ™åËØÅÁ†Å -->
                                        <div style="font-size: 13px; color: var(--gray-700); margin-top: 8px;">
                                            <span style="color: var(--gray-500);">${highlightedLabel}</span>
                                            <span style="background: #FEF3C7; padding: 4px 8px; border-radius: 4px; font-weight: 600; font-family: monospace;">${pattern.example_code}</span>
                                        </div>
                                    </div>
                                    <div style="text-align: right; margin-left: 16px;">
                                        <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">
                                            ${usageText}
                                        </div>
                                        ${pattern.usage_count > 0 ? `
                                        <div style="font-size: 12px; color: ${successRate >= 80 ? 'var(--success)' : 'var(--warning)'};">
                                            ${successRateText}
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px; border-top: 1px solid var(--gray-200); padding-top: 12px;">
                                    <button class="btn btn-ghost" style="padding: 4px 12px; font-size: 12px;" onclick="deletePattern('${pattern.id}')">
                                        ${deleteButtonText}
                                    </button>
                                </div>
                            </div>
                        `;
                    });

                    patternsList.innerHTML = html;
                } else {
                    patternsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--danger);">' + t('pages.admin.dashboard.sections.llm.patterns.loading_failed') + '</div>';
                }
            } catch (error) {
                patternsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--danger);">' + t('pages.admin.dashboard.sections.llm.patterns.network_error') + '</div>';
            }
        }

        // Âà†Èô§Ê®°Âºè
        async function deletePattern(patternId) {
            const t = window.t || ((key) => key);
            if (!confirm(t('pages.admin.dashboard.sections.llm.patterns.confirm_delete'))) {
                return;
            }

            try {
                const token = localStorage.getItem('admin_token');
                const response = await fetch(`/api/patterns/${patternId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showMessage(message, t('pages.admin.dashboard.sections.llm.patterns.delete_success'), 'success');
                    loadPatterns();
                } else {
                    showMessage(message, t('pages.admin.dashboard.sections.llm.patterns.delete_failed', { message: data.message }), 'error');
                }
            } catch (error) {
                showMessage(message, t('pages.admin.dashboard.sections.llm.patterns.delete_failed', { message: error.message }), 'error');
            }
        }

        // Initialize language switcher for login page
        function initLoginLanguageSwitcher() {
            const container = document.getElementById('loginLangSwitcher');
            if (!container) return;

            // Wait for i18n to be loaded
            if (!window.isI18nLoaded || !window.isI18nLoaded()) {
                setTimeout(initLoginLanguageSwitcher, 100);
                return;
            }

            const currentLang = window.getCurrentLanguage ? window.getCurrentLanguage() : 'en-US';
            const availableLanguages = {
                'en-US': { name: 'English', flag: 'üá∫üá∏', nativeName: 'EN' },
                'zh-CN': { name: 'ÁÆÄ‰Ωì‰∏≠Êñá', flag: 'üá®üá≥', nativeName: '‰∏≠Êñá' }
            };

            const currentLangData = availableLanguages[currentLang];
            const otherLangs = Object.keys(availableLanguages).filter(code => code !== currentLang);

            const switcherHTML = `
                <button class="lang-btn" id="loginLangBtn" aria-label="Switch language" aria-haspopup="true" aria-expanded="false">
                    <span class="lang-name">${currentLangData.flag}</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="lang-chevron">
                        <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                    </svg>
                </button>
                <div class="lang-dropdown" id="loginLangDropdown" role="menu" aria-hidden="true">
                    ${otherLangs.map(code => {
                        const lang = availableLanguages[code];
                        return `
                            <a href="#" class="lang-option" data-lang="${code}" role="menuitem">
                                <span class="lang-flag">${lang.flag}</span>
                                <span class="lang-text">${lang.nativeName}</span>
                            </a>
                        `;
                    }).join('')}
                </div>
            `;

            container.innerHTML = switcherHTML;

            // Setup event listeners
            const langBtn = document.getElementById('loginLangBtn');
            const langDropdown = document.getElementById('loginLangDropdown');

            langBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const isOpen = langDropdown.classList.contains('show');
                if (isOpen) {
                    langDropdown.classList.remove('show');
                    langBtn.setAttribute('aria-expanded', 'false');
                } else {
                    langDropdown.classList.add('show');
                    langBtn.setAttribute('aria-expanded', 'true');
                }
            });

            document.addEventListener('click', (e) => {
                if (!container.contains(e.target)) {
                    langDropdown.classList.remove('show');
                    langBtn.setAttribute('aria-expanded', 'false');
                }
            });

            container.querySelectorAll('.lang-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetLang = option.getAttribute('data-lang');
                    if (window.switchLanguage) {
                        window.switchLanguage(targetLang);
                    }
                });
            });
        }

        // Initialize language switcher for admin page
        function initAdminLanguageSwitcher() {
            const container = document.getElementById('langSwitcherContainer');
            if (!container) return;

            // Wait for i18n to be loaded
            if (!window.isI18nLoaded || !window.isI18nLoaded()) {
                setTimeout(initAdminLanguageSwitcher, 100);
                return;
            }

            const currentLang = window.getCurrentLanguage ? window.getCurrentLanguage() : 'en-US';
            const availableLanguages = {
                'en-US': { name: 'English', flag: 'üá∫üá∏', nativeName: 'English' },
                'zh-CN': { name: 'ÁÆÄ‰Ωì‰∏≠Êñá', flag: 'üá®üá≥', nativeName: 'ÁÆÄ‰Ωì‰∏≠Êñá' }
            };

            const currentLangData = availableLanguages[currentLang];
            const otherLangs = Object.keys(availableLanguages).filter(code => code !== currentLang);

            const switcherHTML = `
                <button class="lang-btn" id="adminLangBtn" aria-label="Switch language" aria-haspopup="true" aria-expanded="false">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="lang-icon">
                        <path d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                    </svg>
                    <span class="lang-name">${currentLangData.flag} <span>${currentLangData.nativeName}</span></span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="lang-chevron">
                        <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                    </svg>
                </button>
                <div class="lang-dropdown" id="adminLangDropdown" role="menu" aria-hidden="true">
                    ${otherLangs.map(code => {
                        const lang = availableLanguages[code];
                        return `
                            <a href="#" class="lang-option" data-lang="${code}" role="menuitem">
                                <span class="lang-flag">${lang.flag}</span>
                                <span class="lang-text">${lang.nativeName}</span>
                            </a>
                        `;
                    }).join('')}
                </div>
            `;

            container.innerHTML = switcherHTML;
            container.className = 'language-switcher-admin';

            // Setup event listeners
            const langBtn = document.getElementById('adminLangBtn');
            const langDropdown = document.getElementById('adminLangDropdown');

            langBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const isOpen = langDropdown.classList.contains('show');
                if (isOpen) {
                    langDropdown.classList.remove('show');
                    langBtn.setAttribute('aria-expanded', 'false');
                } else {
                    langDropdown.classList.add('show');
                    langBtn.setAttribute('aria-expanded', 'true');
                }
            });

            document.addEventListener('click', (e) => {
                if (!container.contains(e.target)) {
                    langDropdown.classList.remove('show');
                    langBtn.setAttribute('aria-expanded', 'false');
                }
            });

            container.querySelectorAll('.lang-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetLang = option.getAttribute('data-lang');
                    if (window.switchLanguage) {
                        window.switchLanguage(targetLang);
                    }
                });
            });
        }

        // È°µÈù¢Âä†ËΩΩÊó∂Ëá™Âä®Âä†ËΩΩÊ®°ÂºèÂàóË°®
        window.addEventListener('load', function() {
            // Initialize language switchers (both login and admin)
            initLoginLanguageSwitcher();
            initAdminLanguageSwitcher();

            // Âª∂ËøüÂä†ËΩΩÔºåÁ≠âÂæÖÁôªÂΩïÂÆåÊàê
            setTimeout(() => {
                if (localStorage.getItem('admin_token')) {
                    loadPatterns();
                }
            }, 1000);
        });
    </script>
</body>
</html>
                                <div class="form-hint" style="margin-left: 28px;">‰ΩøÁî® Cloudflare Workers 
